

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/source/images/icon.png">
  <link rel="icon" href="/source/images/icon.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Cookiecoolkid">
  <meta name="keywords" content="">
  
    <meta name="description" content="üåü ÂèÇËÄÉËµÑÊñôÔºö Linux È´òÊÄßËÉΩÊúçÂä°Âô®ÁºñÁ®ã (Ê∏∏ÂèåËëó)">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux È´òÊÄßËÉΩÊúçÂä°Âô®ÁºñÁ®ã">
<meta property="og:url" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/index.html">
<meta property="og:site_name" content="Cookiecoolkid">
<meta property="og:description" content="üåü ÂèÇËÄÉËµÑÊñôÔºö Linux È´òÊÄßËÉΩÊúçÂä°Âô®ÁºñÁ®ã (Ê∏∏ÂèåËëó)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/socketOpt.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/LinuxSysLog.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/CS.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/P2P.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/ServerFrame.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/IOModel.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/Reactor.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/Proactor.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/HSHA.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/HSHAwork.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/HSHR.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/LF1.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/LF2.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/FDReadyCondition.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/IOCmp.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/EventDemult.png">
<meta property="og:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/Libeventgraph.png">
<meta property="article:published_time" content="2024-10-20T02:31:53.000Z">
<meta property="article:modified_time" content="2024-10-26T08:55:34.896Z">
<meta property="article:author" content="Cookiecoolkid">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="ÁΩëÁªúÁºñÁ®ã">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/socketOpt.png">
  
  
  
  <title>Linux È´òÊÄßËÉΩÊúçÂä°Âô®ÁºñÁ®ã - Cookiecoolkid</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ‰∏ªÈ¢ò‰æùËµñÁöÑÂõæÊ†áÂ∫ìÔºå‰∏çË¶ÅËá™Ë°å‰øÆÊîπ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"github.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Cookiecoolkid" type="application/atom+xml">
<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 40vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Cookiecoolkid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>È¶ñÈ°µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>ÂΩíÊ°£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>ÂàÜÁ±ª</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Ê†áÁ≠æ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>ÂÖ≥‰∫é</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Linux È´òÊÄßËÉΩÊúçÂä°Âô®ÁºñÁ®ã"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-10-20 10:31" pubdate>
          2024Âπ¥10Êúà20Êó• ‰∏äÂçà
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          7.3k Â≠ó
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          61 ÂàÜÈíü
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Linux È´òÊÄßËÉΩÊúçÂä°Âô®ÁºñÁ®ã</h1>
            
            
              <div class="markdown-body">
                
                <p>üåü ÂèÇËÄÉËµÑÊñôÔºö Linux È´òÊÄßËÉΩÊúçÂä°Âô®ÁºñÁ®ã (Ê∏∏ÂèåËëó)</p>
<span id="more"></span>
<h2 id="linux-ÁΩëÁªúÁºñÁ®ãÂü∫Á°Ä-api">Linux ÁΩëÁªúÁºñÁ®ãÂü∫Á°Ä API</h2>
<h4 id="socket-Âú∞ÂùÄ-api">Socket Âú∞ÂùÄ API</h4>
<h5 id="‰∏ªÊú∫Â≠óËäÇÂ∫èÂíåÁΩëÁªúÂ≠óËäÇÂ∫è">‰∏ªÊú∫Â≠óËäÇÂ∫èÂíåÁΩëÁªúÂ≠óËäÇÂ∫è</h5>
<ul>
<li>Â§ßÁ´ØÂ≠óËäÇÂ∫èÔºöÈ´ò‰ΩçÂ≠óËäÇÂ≠òÊîæÂú®‰Ωé‰ΩçÂú∞ÂùÄÔºåÈÄöÂ∏∏‰∏∫ÁΩëÁªúÂ≠óËäÇÂ∫è</li>
<li>Â∞èÁ´ØÂ≠óËäÇÂ∫èÔºöÈ´ò‰ΩçÂ≠óËäÇÂ≠òÊîæÂú®È´ò‰ΩçÂú∞ÂùÄÔºåÈÄöÂ∏∏‰∏∫‰∏ªÊú∫Â≠óËäÇÂ∫è</li>
</ul>
<h5 id="linux-Â≠óËäÇÂ∫èËΩ¨Êç¢ÂáΩÊï∞">Linux Â≠óËäÇÂ∫èËΩ¨Êç¢ÂáΩÊï∞</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">uint32_t</span> <span class="hljs-title">htonl</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> hostlong)</span></span>; <span class="hljs-comment">// ‰∏ªÊú∫Â≠óËäÇÂ∫èËΩ¨ÁΩëÁªúÂ≠óËäÇÂ∫è</span><br><span class="hljs-function"><span class="hljs-type">uint16_t</span> <span class="hljs-title">htons</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> hostshort)</span></span>; <span class="hljs-comment">// ‰∏ªÊú∫Â≠óËäÇÂ∫èËΩ¨ÁΩëÁªúÂ≠óËäÇÂ∫è</span><br><span class="hljs-function"><span class="hljs-type">uint32_t</span> <span class="hljs-title">ntohl</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> netlong)</span></span>; <span class="hljs-comment">// ÁΩëÁªúÂ≠óËäÇÂ∫èËΩ¨‰∏ªÊú∫Â≠óËäÇÂ∫è</span><br><span class="hljs-function"><span class="hljs-type">uint16_t</span> <span class="hljs-title">ntohs</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> netshort)</span></span>; <span class="hljs-comment">// ÁΩëÁªúÂ≠óËäÇÂ∫èËΩ¨‰∏ªÊú∫Â≠óËäÇÂ∫è</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="ÈÄöÁî®-socket-Âú∞ÂùÄÁªìÊûÑ">ÈÄöÁî® Socket Âú∞ÂùÄÁªìÊûÑ</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr</span> {<br>    <span class="hljs-type">sa_family_t</span> sa_family; <span class="hljs-comment">// Âú∞ÂùÄÊóè</span><br>    <span class="hljs-type">char</span> sa_data[<span class="hljs-number">14</span>]; <span class="hljs-comment">// Âú∞ÂùÄ‰ø°ÊÅØ</span><br>};<br></code></pre></td></tr></tbody></table></figure>
<p>‰ª•ÂèäÊõ¥ÈÄöÁî®ÁöÑ <code>sockaddr_storage</code> ÁªìÊûÑ‰Ωì</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_storage</span> {<br>    <span class="hljs-type">sa_family_t</span> ss_family; <span class="hljs-comment">// Âú∞ÂùÄÊóè</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> __ss_align; <span class="hljs-comment">// ÂØπÈΩê</span><br>    <span class="hljs-type">char</span> __ss_padding[<span class="hljs-number">128</span> - <span class="hljs-built_in">sizeof</span>(__ss_align)]; <span class="hljs-comment">// Ë°•ÈΩê</span><br>};<br></code></pre></td></tr></tbody></table></figure>
<p>‰ΩÜ‰∏äËø∞ÁªìÊûÑ‰ΩìÂπ∂‰∏çÂåÖÂê´Âú∞ÂùÄ‰ø°ÊÅØ(ËøòÈúÄË¶ÅËá™Ë°åËøõË°å‰ΩçÊìç‰Ωú)ÔºåÂõ†Ê≠§ Linux Â∞ÅË£Ö‰∫ÜÊõ¥ÂÖ∑‰ΩìÁöÑÁªìÊûÑ‰ΩìÔºåÂ¶Ç <code>sockaddr_in</code> Âíå <code>sockaddr_in6</code></p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> {<br>    <span class="hljs-type">sa_family_t</span> sin_family; <span class="hljs-comment">// Âú∞ÂùÄÊóè</span><br>    <span class="hljs-type">in_port_t</span> sin_port; <span class="hljs-comment">// Á´ØÂè£Âè∑</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">in_addr</span> sin_addr; <span class="hljs-comment">// IPv4 Âú∞ÂùÄ</span><br>    <span class="hljs-type">char</span> sin_zero[<span class="hljs-number">8</span>]; <span class="hljs-comment">// Ë°•ÈΩê</span><br>};<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">addr_in</span> {<br>    <span class="hljs-type">uint32_t</span> s_addr; <span class="hljs-comment">// IPv4 Âú∞ÂùÄ</span><br>};<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in6</span> {<br>    <span class="hljs-type">sa_family_t</span> sin6_family; <span class="hljs-comment">// Âú∞ÂùÄÊóè</span><br>    <span class="hljs-type">in_port_t</span> sin6_port; <span class="hljs-comment">// Á´ØÂè£Âè∑</span><br>    <span class="hljs-type">uint32_t</span> sin6_flowinfo; <span class="hljs-comment">// ÊµÅ‰ø°ÊÅØ</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">in6_addr</span> sin6_addr; <span class="hljs-comment">// IPv6 Âú∞ÂùÄ</span><br>    <span class="hljs-type">uint32_t</span> sin6_scope_id; <span class="hljs-comment">// ‰ΩúÁî®Âüü ID</span><br>};<br></code></pre></td></tr></tbody></table></figure>
<h5 id="ÂçèËÆÆÊóè">ÂçèËÆÆÊóè</h5>
<ul>
<li>AF_INETÔºöIPv4</li>
<li>AF_INET6ÔºöIPv6</li>
<li>AF_UNIXÔºöUNIX Âüü</li>
<li>AF_* ‰∏é PF_* ÂÆèÂèØ‰ª•‰∫íÊç¢‰ΩøÁî®</li>
</ul>
<h4 id="ip-Âú∞ÂùÄËΩ¨Êç¢ÂáΩÊï∞">IP Âú∞ÂùÄËΩ¨Êç¢ÂáΩÊï∞</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">in_addr_t</span> <span class="hljs-title">inet_addr</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *str)</span></span>; <span class="hljs-comment">// ÁÇπÂàÜÂçÅËøõÂà∂ËΩ¨Êç¢‰∏∫ÁΩëÁªúÂ≠óËäÇÂ∫èÔºåÂ§±Ë¥•ËøîÂõû INADDR_NONE</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">inet_aton</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *str, <span class="hljs-keyword">struct</span> in_addr *addr)</span></span>; <span class="hljs-comment">// ÁÇπÂàÜÂçÅËøõÂà∂ËΩ¨Êç¢‰∏∫ÁΩëÁªúÂ≠óËäÇÂ∫èÔºåÊàêÂäüËøîÂõû 1ÔºåÂ§±Ë¥•ËøîÂõû 0</span><br><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-title">inet_ntoa</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> in_addr addr)</span></span>; <span class="hljs-comment">// ÁΩëÁªúÂ≠óËäÇÂ∫èËΩ¨Êç¢‰∏∫ÁÇπÂàÜÂçÅËøõÂà∂ÔºåËøîÂõûÈùôÊÄÅÂÜÖÂ≠òÂú∞ÂùÄ(‰∏çÂèØÈáçÂÖ•)</span><br><br><span class="hljs-comment">// @param af: AF_INET Êàñ AF_INET6</span><br><span class="hljs-comment">// @param src: ÁÇπÂàÜÂçÅËøõÂà∂Â≠óÁ¨¶‰∏≤</span><br><span class="hljs-comment">// @param dst: Â≠òÊîæËΩ¨Êç¢ÂêéÁöÑÂú∞ÂùÄ</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">inet_pton</span><span class="hljs-params">(<span class="hljs-type">int</span> af, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *src, <span class="hljs-type">void</span> *dst)</span></span>; <span class="hljs-comment">// ÁÇπÂàÜÂçÅËøõÂà∂ËΩ¨Êç¢‰∏∫ÁΩëÁªúÂ≠óËäÇÂ∫èÔºåÊàêÂäüËøîÂõû 1ÔºåÂ§±Ë¥•ËøîÂõû 0</span><br><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-title">inet_ntop</span><span class="hljs-params">(<span class="hljs-type">int</span> af, <span class="hljs-type">const</span> <span class="hljs-type">void</span> *src, <span class="hljs-type">char</span> *dst, <span class="hljs-type">socklen_t</span> size)</span></span>; <span class="hljs-comment">// ÁΩëÁªúÂ≠óËäÇÂ∫èËΩ¨Êç¢‰∏∫ÁÇπÂàÜÂçÅËøõÂà∂ÔºåÊàêÂäüËøîÂõû dstÔºåÂ§±Ë¥•ËøîÂõû NULL Âπ∂ËÆæÁΩÆ errno</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="ÂàõÂª∫-socket">ÂàõÂª∫ Socket</h4>
<ul>
<li>Everything is a file</li>
</ul>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><br><span class="hljs-comment">// @param domain: PF_INET, PF_INET6, PF_UNIX</span><br><span class="hljs-comment">// @param type: SOCK_STREAM(ÊµÅÊúçÂä°TCP), SOCK_DGRAM(Êï∞ÊçÆÊä•ÊúçÂä°UDP), SOCK_RAW(ÂéüÂßãÂ•óÊé•Â≠ó)</span><br><span class="hljs-comment">// @param protocol: IPPROTO_TCP, IPPROTO_UDP, IPPROTO_SCTP(ÈªòËÆ§ 0, Âõ†‰∏∫ domain Âíå type Â∑≤ÁªèÂÜ≥ÂÆö‰∫ÜÂçèËÆÆ)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">socket</span><span class="hljs-params">(<span class="hljs-type">int</span> domain, <span class="hljs-type">int</span> type, <span class="hljs-type">int</span> protocol)</span></span>; <span class="hljs-comment">// ÂàõÂª∫‰∏Ä‰∏™Â•óÊé•Â≠óÔºåÊàêÂäüËøîÂõûÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="ÂëΩÂêç-socket">ÂëΩÂêç Socket</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// @param sockfd: Â•óÊé•Â≠óÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param addr: ÊåáÂêë sockaddr ÁªìÊûÑ‰ΩìÁöÑÊåáÈíà</span><br><span class="hljs-comment">// @param addrlen: sockaddr ÁªìÊûÑ‰ΩìÁöÑÈïøÂ∫¶</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">bind</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> sockaddr *addr, <span class="hljs-type">socklen_t</span> addrlen)</span></span>; <span class="hljs-comment">// ÁªëÂÆöÂ•óÊé•Â≠óÂíåÂú∞ÂùÄÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>ÈÄöÂ∏∏‰∏∫ TCP ÊúçÂä°Âô®ÁªëÂÆöÂú∞ÂùÄÂíåÁ´ØÂè£(Server Á´Ø) #### ÁõëÂê¨ Socket <figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// @param sockfd: Â•óÊé•Â≠óÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param backlog: ÊúÄÂ§ßËøûÊé•Êï∞</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">listen</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">int</span> backlog)</span></span>; <span class="hljs-comment">// ÁõëÂê¨Â•óÊé•Â≠óÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="Êé•ÂèóËøûÊé•">Êé•ÂèóËøûÊé•</h4>
<p>Âêç‰∏∫ accept Êé•ÂèóËøûÊé•Ôºå‰ΩÜÂÆûÈôÖÂÖ∂Âπ∂‰∏çÂÖ≥ÂøÉËøûÊé•ÔºåÂè™ÊòØ‰ªéÁõëÂê¨ÈòüÂàó‰∏≠ÂèñÂá∫‰∏Ä‰∏™ËøûÊé• </p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// @param sockfd: Â•óÊé•Â≠óÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param addr: ÊåáÂêë sockaddr ÁªìÊûÑ‰ΩìÁöÑÊåáÈíà</span><br><span class="hljs-comment">// @param addrlen: sockaddr ÁªìÊûÑ‰ΩìÁöÑÈïøÂ∫¶</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">accept</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-keyword">struct</span> sockaddr *addr, <span class="hljs-type">socklen_t</span> *addrlen)</span></span>; <span class="hljs-comment">// Êé•ÂèóËøûÊé•ÔºåÊàêÂäüËøîÂõûÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure><p></p>
<h4 id="ËøûÊé•-socket">ËøûÊé• Socket</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// @param sockfd: Â•óÊé•Â≠óÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param addr: ÊåáÂêë sockaddr ÁªìÊûÑ‰ΩìÁöÑÊåáÈíà</span><br><span class="hljs-comment">// @param addrlen: sockaddr ÁªìÊûÑ‰ΩìÁöÑÈïøÂ∫¶</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">connect</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> sockaddr *addr, <span class="hljs-type">socklen_t</span> addrlen)</span></span>; <span class="hljs-comment">// ËøûÊé•Â•óÊé•Â≠óÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>ÈÄöÂ∏∏‰∏∫ TCP ÂÆ¢Êà∑Á´ØËøûÊé•Âú∞ÂùÄÂíåÁ´ØÂè£(Client Á´Ø)</li>
<li>‰∏ÄÊó¶ËøûÊé•ÊàêÂäüÔºåÂÆ¢Êà∑Á´ØÂíåÊúçÂä°Âô®Á´ØÈÉΩÂèØ‰ª•ÈÄöËøáËØªÂÜô sockfd ËøõË°åÈÄö‰ø°</li>
</ul>
<h4 id="ÂÖ≥Èó≠-socket">ÂÖ≥Èó≠ Socket</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// @param sockfd: Â•óÊé•Â≠óÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">close</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd)</span></span>; <span class="hljs-comment">// ÂÖ≥Èó≠Â•óÊé•Â≠óÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>close ÂÆûÈôÖ‰∏äÊòØÂ∞Ü sockfd ÁöÑÂºïÁî®ËÆ°Êï∞Âáè 1ÔºåÂè™ÊúâÂΩìÂºïÁî®ËÆ°Êï∞‰∏∫ 0 Êó∂Êâç‰ºöÁúüÊ≠£ÂÖ≥Èó≠Â•óÊé•Â≠ó(Â§öËøõÁ®ãÂÖ±‰∫´Â•óÊé•Â≠óÊó∂)</li>
<li>shutdown ÂèØ‰ª•Á´ãÂç≥ÂÖ≥Èó≠Â•óÊé•Â≠ó</li>
</ul>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// @param sockfd: Â•óÊé•Â≠óÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param how: SHUT_RD(ÂÖ≥Èó≠ËØªÁ´Ø), SHUT_WR(ÂÖ≥Èó≠ÂÜôÁ´Ø), SHUT_RDWR(ÂÖ≥Èó≠ËØªÂÜôÁ´Ø)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">shutdown</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">int</span> how)</span></span>; <span class="hljs-comment">// ÂÖ≥Èó≠Â•óÊé•Â≠óÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="Êï∞ÊçÆËØªÂÜô">Êï∞ÊçÆËØªÂÜô</h4>
<h5 id="tcp-ËØªÂÜô">TCP ËØªÂÜô</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// @param sockfd: Â•óÊé•Â≠óÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param buf: ÁºìÂÜ≤Âå∫</span><br><span class="hljs-comment">// @param len: ÁºìÂÜ≤Âå∫ÈïøÂ∫¶</span><br><span class="hljs-comment">// @param flags: MSG_CONFIRM(Êï∞ÊçÆÂÆåÊï¥ÊÄßÁ°ÆËÆ§), MSG_DONTROUTE(Êï∞ÊçÆ‰∏çÁªèËøáË∑ØÁî±), MSG_DONTWAIT(ÈùûÈòªÂ°û), MSG_OOB(Á¥ßÊÄ•Êï∞ÊçÆ), MSG_PEEK(Á™•Êé¢Êï∞ÊçÆ), MSG_WAITALL(Á≠âÂæÖÂÖ®ÈÉ®Êï∞ÊçÆ)...</span><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">recv</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">void</span> *buf, <span class="hljs-type">size_t</span> len, <span class="hljs-type">int</span> flags)</span></span>; <span class="hljs-comment">// ËØªÂèñÊï∞ÊçÆÔºåÊàêÂäüËøîÂõûËØªÂèñÁöÑÂ≠óËäÇÊï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">send</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">const</span> <span class="hljs-type">void</span> *buf, <span class="hljs-type">size_t</span> len, <span class="hljs-type">int</span> flags)</span></span>; <span class="hljs-comment">// ÂèëÈÄÅÊï∞ÊçÆÔºåÊàêÂäüËøîÂõûÂèëÈÄÅÁöÑÂ≠óËäÇÊï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h5 id="udp-ËØªÂÜô">UDP ËØªÂÜô</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// @param sockfd: Â•óÊé•Â≠óÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param buf: ÁºìÂÜ≤Âå∫</span><br><span class="hljs-comment">// @param len: ÁºìÂÜ≤Âå∫ÈïøÂ∫¶</span><br><span class="hljs-comment">// @param flags: ...</span><br><span class="hljs-comment">// @param src_addr: ÂèëÈÄÅÁ´ØÁöÑ socket Âú∞ÂùÄ‰ø°ÊÅØ</span><br><span class="hljs-comment">// @param addrlen: sockaddr ÁªìÊûÑ‰ΩìÁöÑÈïøÂ∫¶</span><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">recvfrom</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">void</span> *buf, <span class="hljs-type">size_t</span> len, <span class="hljs-type">int</span> flags, <span class="hljs-keyword">struct</span> sockaddr *src_addr, <span class="hljs-type">socklen_t</span> *addrlen)</span></span>; <span class="hljs-comment">// ËØªÂèñÊï∞ÊçÆÔºåÊàêÂäüËøîÂõûËØªÂèñÁöÑÂ≠óËäÇÊï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><br><span class="hljs-comment">// @param dest_addr: Êé•Êî∂Á´ØÁöÑ socket Âú∞ÂùÄ‰ø°ÊÅØ</span><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">sendto</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">const</span> <span class="hljs-type">void</span> *buf, <span class="hljs-type">size_t</span> len, <span class="hljs-type">int</span> flags, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> sockaddr *dest_addr, <span class="hljs-type">socklen_t</span> addrlen)</span></span>; <span class="hljs-comment">// ÂèëÈÄÅÊï∞ÊçÆÔºåÊàêÂäüËøîÂõûÂèëÈÄÅÁöÑÂ≠óËäÇÊï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h5 id="ÈÄöÁî®ËØªÂÜô">ÈÄöÁî®ËØªÂÜô</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">recvmsg</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-keyword">struct</span> msghdr *msg, <span class="hljs-type">int</span> flags)</span></span>; <span class="hljs-comment">// ËØªÂèñÊï∞ÊçÆÔºåÊàêÂäüËøîÂõûËØªÂèñÁöÑÂ≠óËäÇÊï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">sendmsg</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> msghdr *msg, <span class="hljs-type">int</span> flags)</span></span>; <span class="hljs-comment">// ÂèëÈÄÅÊï∞ÊçÆÔºåÊàêÂäüËøîÂõûÂèëÈÄÅÁöÑÂ≠óËäÇÊï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// msghdr ÁªìÊûÑ‰Ωì</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">msghdr</span> {<br>    <span class="hljs-type">void</span> *msg_name; <span class="hljs-comment">// socket Âú∞ÂùÄ‰ø°ÊÅØ</span><br>    <span class="hljs-type">socklen_t</span> msg_namelen; <span class="hljs-comment">// socket Âú∞ÂùÄ‰ø°ÊÅØÈïøÂ∫¶</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">iovec</span> *msg_iov; <span class="hljs-comment">// ÁºìÂÜ≤Âå∫</span><br>    <span class="hljs-type">int</span> msg_iovlen; <span class="hljs-comment">// ÁºìÂÜ≤Âå∫ÈïøÂ∫¶</span><br>    <span class="hljs-type">void</span> *msg_control; <span class="hljs-comment">// ÊéßÂà∂‰ø°ÊÅØ</span><br>    <span class="hljs-type">socklen_t</span> msg_controllen; <span class="hljs-comment">// ÊéßÂà∂‰ø°ÊÅØÈïøÂ∫¶</span><br>    <span class="hljs-type">int</span> msg_flags; <span class="hljs-comment">// Ê†áÂøó</span><br>};<br><br><span class="hljs-comment">// iovec ÁªìÊûÑ‰Ωì</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">iovec</span> {<br>    <span class="hljs-type">void</span> *iov_base; <span class="hljs-comment">// ÂÜÖÂ≠òÁºìÂÜ≤Âå∫Ëµ∑ÂßãÂú∞ÂùÄ</span><br>    <span class="hljs-type">size_t</span> iov_len; <span class="hljs-comment">// ÁºìÂÜ≤Âå∫ÈïøÂ∫¶</span><br>};<br></code></pre></td></tr></tbody></table></figure>
<h4 id="Â∏¶Â§ñÊï∞ÊçÆ">Â∏¶Â§ñÊï∞ÊçÆ</h4>
<ul>
<li>TCP Êúâ‰∏Ä‰∏™Â∏¶Â§ñÊï∞ÊçÆÊ†áÂøóÔºåÂèØ‰ª•ÈÄöËøá MSG_OOB Ê†áÂøóÊù•ÂèëÈÄÅÂíåÊé•Êî∂Â∏¶Â§ñÊï∞ÊçÆ(Á¥ßÊÄ•Êï∞ÊçÆ)</li>
</ul>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sockatmark</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd)</span></span>; <span class="hljs-comment">// Âà§Êñ≠ socket ÊòØÂê¶ÊúâÂ∏¶Â§ñÊ†áËÆ∞ÔºåÊòØËøîÂõû 1ÔºåÂê¶ËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="Âú∞ÂùÄ‰ø°ÊÅØÂáΩÊï∞">Âú∞ÂùÄ‰ø°ÊÅØÂáΩÊï∞</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getsockname</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-keyword">struct</span> sockaddr *addr, <span class="hljs-type">socklen_t</span> *addrlen)</span></span>; <span class="hljs-comment">// Ëé∑ÂèñÂ•óÊé•Â≠óÂú∞ÂùÄ‰ø°ÊÅØÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getpeername</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-keyword">struct</span> sockaddr *addr, <span class="hljs-type">socklen_t</span> *addrlen)</span></span>; <span class="hljs-comment">// Ëé∑ÂèñÂØπÁ´ØÂú∞ÂùÄ‰ø°ÊÅØÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="socker-ÈÄâÈ°π">Socker ÈÄâÈ°π</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-comment">// @param sockfd: Â•óÊé•Â≠óÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param level: SOL_SOCKET(ÈÄöÁî®Â•óÊé•Â≠óÈÄâÈ°π), IPPROTO_TCP(ÂçèËÆÆÂ•óÊé•Â≠óÈÄâÈ°π), IPPROTO_IP(IP Â±ÇÂ•óÊé•Â≠óÈÄâÈ°π)</span><br><span class="hljs-comment">// @param optname: ÈÄâÈ°πÂêç</span><br><span class="hljs-comment">// @param optval: ÈÄâÈ°πÂÄº</span><br><span class="hljs-comment">// @param optlen: ÈÄâÈ°πÂÄºÈïøÂ∫¶</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getsockopt</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">int</span> level, <span class="hljs-type">int</span> optname, <span class="hljs-type">void</span> *optval, <span class="hljs-type">socklen_t</span> *optlen)</span></span>; <span class="hljs-comment">// Ëé∑ÂèñÂ•óÊé•Â≠óÈÄâÈ°πÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">setsockopt</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">int</span> level, <span class="hljs-type">int</span> optname, <span class="hljs-type">const</span> <span class="hljs-type">void</span> *optval, <span class="hljs-type">socklen_t</span> optlen)</span></span>; <span class="hljs-comment">// ËÆæÁΩÆÂ•óÊé•Â≠óÈÄâÈ°πÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<div class="figure">
<img src="socketOpt.png" srcset="/img/loading.gif" lazyload alt="socketOpt">
<p class="caption">socketOpt</p>
</div>
<ul>
<li><p>SO_REUSEADDR TCP ÊúçÂä°Âô®Âú®ÂÖ≥Èó≠ÂêéÔºåÂèØËÉΩ‰ºöÊúâ‰∏ÄÊÆµÊó∂Èó¥Â§Ñ‰∫é TIME_WAIT Áä∂ÊÄÅÔºåÊ≠§Êó∂ÂÜçÊ¨°ÂêØÂä®ÊúçÂä°Âô®‰ºöÂØºËá¥ bind Â§±Ë¥•ÔºåÂèØ‰ª•ÈÄöËøáËÆæÁΩÆ SO_REUSEADDR ÈÄâÈ°πÊù•Âº∫Âà∂ÁªëÂÆö</p></li>
<li><p>SO_RCVBUF Âíå SO_SNDBUF ËÆæÁΩÆÊé•Êî∂ÂíåÂèëÈÄÅÁºìÂÜ≤Âå∫Â§ßÂ∞è</p></li>
<li><p>SO_RCVLOWAT Âíå SO_SNDLOWAT ‰∏ÄËà¨Áî®‰∫é io Â§çÁî®Áõ∏ÂÖ≥ api Ë∞ÉÁî®ÔºåËÆæÁΩÆÊé•Êî∂ÂíåÂèëÈÄÅÁºìÂÜ≤Âå∫‰ΩéÊ∞¥‰ΩçÊ†áËÆ∞ÔºåÂΩìÁºìÂÜ≤Âå∫‰∏≠ÁöÑÊï∞ÊçÆÈáè‰Ωé‰∫é‰ΩéÊ∞¥‰ΩçÊ†áËÆ∞Êó∂Ôºå select Âíå poll Â∞ÜËøîÂõûÂèØËØªÊàñÂèØÂÜô</p></li>
<li><p>SO_LINGER ËÆæÁΩÆÂÖ≥Èó≠ socket ÁöÑË°å‰∏∫ÔºåÂΩìËÆæÁΩÆ SO_LINGER ÈÄâÈ°πÊó∂Ôºåclose ‰ºöÈòªÂ°ûÁõ¥Âà∞ÊâÄÊúâÊï∞ÊçÆÂèëÈÄÅÂÆåÊØïÊàñË∂ÖÊó∂ </p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">linger</span> {<br>    <span class="hljs-type">int</span> l_onoff; <span class="hljs-comment">// 0: ÂÖ≥Èó≠Ôºå1: ÂºÄÂêØ</span><br>    <span class="hljs-type">int</span> l_linger; <span class="hljs-comment">// Ë∂ÖÊó∂Êó∂Èó¥</span><br>};<br></code></pre></td></tr></tbody></table></figure><p></p></li>
</ul>
<h4 id="ÁΩëÁªú‰ø°ÊÅØÂáΩÊï∞">ÁΩëÁªú‰ø°ÊÅØÂáΩÊï∞</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-comment">// @param name: ‰∏ªÊú∫Âêç</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">hostent</span>* <span class="hljs-built_in">gethostbyname</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *name); <span class="hljs-comment">// Ëé∑Âèñ‰∏ªÊú∫‰ø°ÊÅØÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><span class="hljs-comment">// @param addr: IP Âú∞ÂùÄ</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">hostent</span>* <span class="hljs-built_in">gethostbyaddr</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *addr, <span class="hljs-type">int</span> len, <span class="hljs-type">int</span> type); <span class="hljs-comment">// Ëé∑Âèñ‰∏ªÊú∫‰ø°ÊÅØÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// hostent ÁªìÊûÑ‰Ωì</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">hostent</span> {<br>    <span class="hljs-type">char</span> *h_name; <span class="hljs-comment">// ‰∏ªÊú∫Âêç</span><br>    <span class="hljs-type">char</span> **h_aliases; <span class="hljs-comment">// ‰∏ªÊú∫Âà´Âêç</span><br>    <span class="hljs-type">int</span> h_addrtype; <span class="hljs-comment">// Âú∞ÂùÄÁ±ªÂûã</span><br>    <span class="hljs-type">int</span> h_length; <span class="hljs-comment">// Âú∞ÂùÄÈïøÂ∫¶</span><br>    <span class="hljs-type">char</span> **h_addr_list; <span class="hljs-comment">// Âú∞ÂùÄÂàóË°®</span><br>};<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">servent</span>* <span class="hljs-built_in">getservbyname</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *name, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *proto); <span class="hljs-comment">// Ëé∑ÂèñÊúçÂä°‰ø°ÊÅØÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">servent</span>* <span class="hljs-built_in">getservbyport</span>(<span class="hljs-type">int</span> port, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *proto); <span class="hljs-comment">// Ëé∑ÂèñÊúçÂä°‰ø°ÊÅØÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// servent ÁªìÊûÑ‰Ωì</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">servent</span> {<br>    <span class="hljs-type">char</span> *s_name; <span class="hljs-comment">// ÊúçÂä°Âêç</span><br>    <span class="hljs-type">char</span> **s_aliases; <span class="hljs-comment">// ÊúçÂä°Âà´Âêç</span><br>    <span class="hljs-type">int</span> s_port; <span class="hljs-comment">// Á´ØÂè£Âè∑</span><br>    <span class="hljs-type">char</span> *s_proto; <span class="hljs-comment">// ÂçèËÆÆ</span><br>};<br><br><span class="hljs-comment">// @param node: ‰∏ªÊú∫ÂêçÊàñ IP Âú∞ÂùÄ</span><br><span class="hljs-comment">// @param service: ÊúçÂä°ÂêçÊàñÁ´ØÂè£Âè∑</span><br><span class="hljs-comment">// @param hints: ÂØπÂú∞ÂùÄ‰ø°ÊÅØÁöÑÈôêÂà∂</span><br><span class="hljs-comment">// @param res: ËøîÂõûÂ≠òÂÇ®ÁöÑÂú∞ÂùÄ‰ø°ÊÅØ</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getaddrinfo</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *node, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *service, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> addrinfo *hints, <span class="hljs-keyword">struct</span> addrinfo **res)</span></span>; <span class="hljs-comment">// Ëé∑ÂèñÂú∞ÂùÄ‰ø°ÊÅØÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// addrinfo ÁªìÊûÑ‰Ωì</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">addrinfo</span> {<br>    <span class="hljs-type">int</span> ai_flags; <span class="hljs-comment">// Ê†áÂøó</span><br>    <span class="hljs-type">int</span> ai_family; <span class="hljs-comment">// Âú∞ÂùÄÊóè</span><br>    <span class="hljs-type">int</span> ai_socktype; <span class="hljs-comment">// Â•óÊé•Â≠óÁ±ªÂûã</span><br>    <span class="hljs-type">int</span> ai_protocol; <span class="hljs-comment">// ÂçèËÆÆ</span><br>    <span class="hljs-type">socklen_t</span> ai_addrlen; <span class="hljs-comment">// Âú∞ÂùÄÈïøÂ∫¶</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr</span> *ai_addr; <span class="hljs-comment">// Âú∞ÂùÄ‰ø°ÊÅØ</span><br>    <span class="hljs-type">char</span> *ai_canonname; <span class="hljs-comment">// ‰∏ªÊú∫Âêç</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">addrinfo</span> *ai_next; <span class="hljs-comment">// ‰∏ã‰∏Ä‰∏™Âú∞ÂùÄ‰ø°ÊÅØ</span><br>};<br><br><span class="hljs-comment">// getaddrinfo ‰ºöÈöêÂºèÂàÜÈÖç addrinfo ÁªìÊûÑ‰ΩìÔºåÈúÄË¶ÅÈÄöËøá freeaddrinfo ÈáäÊîæ</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">freeaddrinfo</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> addrinfo *res)</span></span>; <span class="hljs-comment">// ÈáäÊîæÂú∞ÂùÄ‰ø°ÊÅØ</span><br><br><span class="hljs-comment">// @param sockfd: Â•óÊé•Â≠óÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param addr: ÊåáÂêë sockaddr ÁªìÊûÑ‰ΩìÁöÑÊåáÈíà</span><br><span class="hljs-comment">// @param addrlen: sockaddr ÁªìÊûÑ‰ΩìÁöÑÈïøÂ∫¶</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getnameinfo</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> sockaddr *addr, <span class="hljs-type">socklen_t</span> addrlen, <span class="hljs-type">char</span> *host, <span class="hljs-type">socklen_t</span> hostlen, <span class="hljs-type">char</span> *serv, <span class="hljs-type">socklen_t</span> servlen, <span class="hljs-type">int</span> flags)</span></span>; <span class="hljs-comment">// Ëé∑ÂèñÂú∞ÂùÄ‰ø°ÊÅØÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h2 id="È´òÁ∫ß-io-ÂáΩÊï∞">È´òÁ∫ß I/O ÂáΩÊï∞</h2>
<p>‰∏ªË¶ÅÂàÜ‰∏∫‰∏âÁ±ªÔºö - Áî®‰∫éÂàõÂª∫Êñá‰ª∂ÊèèËø∞Á¨¶ÁöÑÂáΩÊï∞Ôºöpipe, dup, dup2... - Áî®‰∫éËØªÂÜôÊï∞ÊçÆÁöÑÂáΩÊï∞:readv, writev, sendfile, mmap, munmap, splice, tee... - Áî®‰∫éÊéßÂà∂ I/O Ë°å‰∏∫ÁöÑÂáΩÊï∞Ôºöfcntl, ioctl, fcntl64...</p>
<h4 id="pipe">pipe</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// ÂåøÂêçÁÆ°ÈÅì</span><br><span class="hljs-comment">// @param pipefd: Áî®‰∫éÂ≠òÊîæÁÆ°ÈÅìÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶Ôºåpipefd[0] ‰∏∫ËØªÁ´ØÔºåpipefd[1] ‰∏∫ÂÜôÁ´Ø</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pipe</span><span class="hljs-params">(<span class="hljs-type">int</span> pipefd[<span class="hljs-number">2</span>])</span></span>; <span class="hljs-comment">// ÂàõÂª∫ÁÆ°ÈÅìÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// ÂëΩÂêçÁÆ°ÈÅì</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">mkfifo</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">mode_t</span> mode)</span></span>; <span class="hljs-comment">// ÂàõÂª∫ÂëΩÂêçÁÆ°ÈÅìÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="dup-Âíå-dup2">dup Âíå dup2</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// @param oldfd: Ë¶ÅÂ§çÂà∂ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">dup</span><span class="hljs-params">(<span class="hljs-type">int</span> oldfd)</span></span>; <span class="hljs-comment">// Â§çÂà∂Êñá‰ª∂ÊèèËø∞Á¨¶ÔºåÊàêÂäüËøîÂõûÊñ∞ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// @param oldfd: Ë¶ÅÂ§çÂà∂ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param newfd: Êñ∞ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">dup2</span><span class="hljs-params">(<span class="hljs-type">int</span> oldfd, <span class="hljs-type">int</span> newfd)</span></span>; <span class="hljs-comment">// Â§çÂà∂Êñá‰ª∂ÊèèËø∞Á¨¶ÔºåÊàêÂäüËøîÂõûÊñ∞ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="readv-Âíå-writev">readv Âíå writev</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/uio.h&gt;</span></span><br><span class="hljs-comment">// ÂàÜÊï£ËØªÂíåÈõÜ‰∏≠ÂÜô</span><br><span class="hljs-comment">// @param fd: Êñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param iov: iovec ÁªìÊûÑ‰ΩìÊï∞ÁªÑ</span><br><span class="hljs-comment">// @param iovcnt: iovec ÁªìÊûÑ‰ΩìÊï∞ÁªÑÈïøÂ∫¶</span><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">readv</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> iovec *iov, <span class="hljs-type">int</span> iovcnt)</span></span>; <span class="hljs-comment">// ËØªÂèñÊï∞ÊçÆÔºåÊàêÂäüËøîÂõûËØªÂèñÁöÑÂ≠óËäÇÊï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">writev</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> iovec *iov, <span class="hljs-type">int</span> iovcnt)</span></span>; <span class="hljs-comment">// ÂèëÈÄÅÊï∞ÊçÆÔºåÊàêÂäüËøîÂõûÂèëÈÄÅÁöÑÂ≠óËäÇÊï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="sendfile">sendfile</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/sendfile.h&gt;</span></span><br><span class="hljs-comment">// ÂÆåÂÖ®Âú®ÂÜÖÊ†∏‰∏≠Êìç‰ΩúÔºå‰∏çÈúÄË¶ÅÁî®Êà∑ÊÄÅÂíåÂÜÖÊ†∏ÊÄÅ‰πãÈó¥ÁöÑÊï∞ÊçÆÊã∑Ë¥ù(Èõ∂Êã∑Ë¥ù)</span><br><span class="hljs-comment">// @param out_fd: ËæìÂá∫Êñá‰ª∂ÊèèËø∞Á¨¶(ÂøÖÈ°ªÊòØ socket)</span><br><span class="hljs-comment">// @param in_fd: ËæìÂÖ•Êñá‰ª∂ÊèèËø∞Á¨¶(‰∏çÊòØ socket Êàñ pipe)</span><br><span class="hljs-comment">// @param offset: ÂÅèÁßªÈáè</span><br><span class="hljs-comment">// @param count: ‰º†ËæìÂ≠óËäÇÊï∞</span><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">sendfile</span><span class="hljs-params">(<span class="hljs-type">int</span> out_fd, <span class="hljs-type">int</span> in_fd, <span class="hljs-type">off_t</span> *offset, <span class="hljs-type">size_t</span> count)</span></span>; <span class="hljs-comment">// ‰º†ËæìÊñá‰ª∂ÔºåÊàêÂäüËøîÂõû‰º†ËæìÁöÑÂ≠óËäÇÊï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="mmap-Âíå-munmap">mmap Âíå munmap</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-comment">// ÂÜÖÂ≠òÊò†Â∞Ñ</span><br><span class="hljs-comment">// @param addr: Êò†Â∞ÑÂú∞ÂùÄ</span><br><span class="hljs-comment">// @param length: Êò†Â∞ÑÈïøÂ∫¶</span><br><span class="hljs-comment">// @param prot: ‰øùÊä§Ê®°Âºè(PROT_READ, PROT_WRITE, PROT_EXEC, PROT_NONE)</span><br><span class="hljs-comment">// @param flags: Êò†Â∞ÑÊ†áÂøó(MAP_SHARED, MAP_PRIVATE, MAP_ANONYMOUS, MAP_FIXED)</span><br><span class="hljs-comment">// @param fd: Êñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param offset: ÂÅèÁßªÈáè</span><br><span class="hljs-function"><span class="hljs-type">void</span> *<span class="hljs-title">mmap</span><span class="hljs-params">(<span class="hljs-type">void</span> *addr, <span class="hljs-type">size_t</span> length, <span class="hljs-type">int</span> prot, <span class="hljs-type">int</span> flags, <span class="hljs-type">int</span> fd, <span class="hljs-type">off_t</span> offset)</span></span>; <span class="hljs-comment">// Êò†Â∞ÑÂÜÖÂ≠òÔºåÊàêÂäüËøîÂõûÊò†Â∞ÑÂú∞ÂùÄÔºåÂ§±Ë¥•ËøîÂõû MAP_FAILED</span><br><br><span class="hljs-comment">// @param addr: Êò†Â∞ÑÂú∞ÂùÄ</span><br><span class="hljs-comment">// @param length: Êò†Â∞ÑÈïøÂ∫¶</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">munmap</span><span class="hljs-params">(<span class="hljs-type">void</span> *addr, <span class="hljs-type">size_t</span> length)</span></span>; <span class="hljs-comment">// Ëß£Èô§Êò†Â∞ÑÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="splice-Âíå-tee">splice Âíå tee</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-comment">// splice Áî®‰∫éÂú®‰∏§‰∏™Êñá‰ª∂ÊèèËø∞Á¨¶‰πãÈó¥ÁßªÂä®Êï∞ÊçÆÔºå‰∏çÈúÄË¶ÅÁî®Êà∑ÊÄÅÂíåÂÜÖÊ†∏ÊÄÅ‰πãÈó¥ÁöÑÊï∞ÊçÆÊã∑Ë¥ù(Èõ∂Êã∑Ë¥ù)</span><br><span class="hljs-comment">// splice Ë¶ÅÊ±Ç fd_in Âíå fd_out ÂÖ∂‰∏≠‰∏Ä‰∏™ÂøÖÈ°ªÊòØÁÆ°ÈÅì</span><br><span class="hljs-comment">// @param fd_in: ËæìÂÖ•Êñá‰ª∂ÊèèËø∞Á¨¶(ÂèØ‰ª•‰∏∫ÁÆ°ÈÅìÔºå‰∏îËã•‰∏∫ÁÆ°ÈÅìÔºåoff_in ÂøÖÈ°ª‰∏∫ NULL)</span><br><span class="hljs-comment">// @param off_in: ËæìÂÖ•Êñá‰ª∂ÊèèËø∞Á¨¶ÂÅèÁßªÈáè</span><br><span class="hljs-comment">// @param fd_out: ËæìÂá∫Êñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param off_out: ËæìÂá∫Êñá‰ª∂ÊèèËø∞Á¨¶ÂÅèÁßªÈáè</span><br><span class="hljs-comment">// @param len: ‰º†ËæìÂ≠óËäÇÊï∞</span><br><span class="hljs-comment">// @param flags: SPLICE_F_MOVE, SPLICE_F_NONBLOCK</span><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">splice</span><span class="hljs-params">(<span class="hljs-type">int</span> fd_in, <span class="hljs-type">loff_t</span> *off_in, <span class="hljs-type">int</span> fd_out, <span class="hljs-type">loff_t</span> *off_out, <span class="hljs-type">size_t</span> len, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flags)</span></span>; <span class="hljs-comment">// ÁßªÂä®Êï∞ÊçÆÔºåÊàêÂäüËøîÂõû‰º†ËæìÁöÑÂ≠óËäÇÊï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// tee Áî®‰∫éÂú®‰∏§‰∏™ÁÆ°ÈÅì‰πãÈó¥ÁßªÂä®Êï∞ÊçÆÔºå‰∏çÈúÄË¶ÅÁî®Êà∑ÊÄÅÂíåÂÜÖÊ†∏ÊÄÅ‰πãÈó¥ÁöÑÊï∞ÊçÆÊã∑Ë¥ù(Èõ∂Êã∑Ë¥ù)</span><br><span class="hljs-comment">// @param fd_in: ËæìÂÖ•Êñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param fd_out: ËæìÂá∫Êñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param len: ‰º†ËæìÂ≠óËäÇÊï∞</span><br><span class="hljs-comment">// @param flags: SPLICE_F_MOVE, SPLICE_F_NONBLOCK</span><br><span class="hljs-function"><span class="hljs-type">ssize_t</span> <span class="hljs-title">tee</span><span class="hljs-params">(<span class="hljs-type">int</span> fd_in, <span class="hljs-type">int</span> fd_out, <span class="hljs-type">size_t</span> len, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flags)</span></span>; <span class="hljs-comment">// ÁßªÂä®Êï∞ÊçÆÔºåÊàêÂäüËøîÂõû‰º†ËæìÁöÑÂ≠óËäÇÊï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="fcntl">fcntl</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><br><span class="hljs-comment">// @param fd: Êñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param cmd: F_GETFL(Ëé∑ÂèñÊñá‰ª∂Áä∂ÊÄÅÊ†áÂøó), F_SETFL(ËÆæÁΩÆÊñá‰ª∂Áä∂ÊÄÅÊ†áÂøóÔºåÈÄöÂ∏∏Âú®ÁΩëÁªúÁºñÁ®ã‰∏≠ËÆæÁΩÆÈùûÈòªÂ°ûÁä∂ÊÄÅ O_NONBLOCK), F_GETFD(Ëé∑ÂèñÊñá‰ª∂ÊèèËø∞Á¨¶Ê†áÂøó), F_SETFD(ËÆæÁΩÆÊñá‰ª∂ÊèèËø∞Á¨¶Ê†áÂøó)...</span><br><span class="hljs-comment">// @param arg: ÂèÇÊï∞</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">fcntl</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">int</span> cmd, ...)</span></span>; <span class="hljs-comment">// ÊéßÂà∂Êñá‰ª∂ÊèèËø∞Á¨¶ÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h2 id="linux-ÊúçÂä°Âô®Á®ãÂ∫èËßÑËåÉ">Linux ÊúçÂä°Âô®Á®ãÂ∫èËßÑËåÉ</h2>
<h4 id="Êó•Âøó">Êó•Âøó</h4>
<div class="figure">
<img src="LinuxSysLog.png" srcset="/img/loading.gif" lazyload alt="LinuxSysLog">
<p class="caption">LinuxSysLog</p>
</div>
<h5 id="syslog">syslog</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;syslog.h&gt;</span></span><br><span class="hljs-comment">// @param priority: Êó•ÂøóÁ∫ßÂà´</span><br><span class="hljs-comment">// @param format: Êó•ÂøóÊ†ºÂºè</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">syslog</span><span class="hljs-params">(<span class="hljs-type">int</span> priority, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *format, ...)</span></span>; <span class="hljs-comment">// ÂÜôÂÖ•Êó•Âøó</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">openlog</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *ident, <span class="hljs-type">int</span> option, <span class="hljs-type">int</span> facility)</span></span>; <span class="hljs-comment">// ÊâìÂºÄÊó•Âøó(Ëøõ‰∏ÄÊ≠•Ê†ºÂºèÂåñ)</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">setlogmask</span><span class="hljs-params">(<span class="hljs-type">int</span> maskpri)</span></span>; <span class="hljs-comment">// ËÆæÁΩÆÊó•ÂøóÁ∫ßÂà´</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">closelog</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// ÂÖ≥Èó≠Êó•Âøó</span><br><br><span class="hljs-comment">// Êó•ÂøóÁ∫ßÂà´</span><br>LOG_EMERG   <span class="hljs-comment">// Á≥ªÁªü‰∏çÂèØÁî®</span><br>LOG_ALERT   <span class="hljs-comment">// Êä•Ë≠¶</span><br>LOG_CRIT    <span class="hljs-comment">// ‰∏•ÈáçÈîôËØØ</span><br>LOG_ERR     <span class="hljs-comment">// ‰∏ÄËà¨ÈîôËØØ</span><br>LOG_WARNING <span class="hljs-comment">// Ë≠¶Âëä</span><br>LOG_NOTICE  <span class="hljs-comment">// ÈÄöÁü•</span><br>LOG_INFO    <span class="hljs-comment">// ‰ø°ÊÅØ</span><br>LOG_DEBUG   <span class="hljs-comment">// Ë∞ÉËØï</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="Áî®Êà∑‰ø°ÊÅØ">Áî®Êà∑‰ø°ÊÅØ</h4>
<h5 id="uid-euid-gid-egid">UID, EUID, GID, EGID</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">uid_t</span> <span class="hljs-title">getuid</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// Ëé∑ÂèñÁî®Êà∑ ID</span><br><span class="hljs-function"><span class="hljs-type">uid_t</span> <span class="hljs-title">geteuid</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// Ëé∑ÂèñÊúâÊïàÁî®Êà∑ ID</span><br><span class="hljs-function"><span class="hljs-type">gid_t</span> <span class="hljs-title">getgid</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// Ëé∑ÂèñÁªÑ ID</span><br><span class="hljs-function"><span class="hljs-type">gid_t</span> <span class="hljs-title">getegid</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// Ëé∑ÂèñÊúâÊïàÁªÑ ID</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setuid</span><span class="hljs-params">(<span class="hljs-type">uid_t</span> uid)</span></span>; <span class="hljs-comment">// ËÆæÁΩÆÁî®Êà∑ ID</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">seteuid</span><span class="hljs-params">(<span class="hljs-type">uid_t</span> euid)</span></span>; <span class="hljs-comment">// ËÆæÁΩÆÊúâÊïàÁî®Êà∑ ID</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setgid</span><span class="hljs-params">(<span class="hljs-type">gid_t</span> gid)</span></span>; <span class="hljs-comment">// ËÆæÁΩÆÁªÑ ID</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setegid</span><span class="hljs-params">(<span class="hljs-type">gid_t</span> egid)</span></span>; <span class="hljs-comment">// ËÆæÁΩÆÊúâÊïàÁªÑ ID</span><br></code></pre></td></tr></tbody></table></figure>
<h5 id="ÂàáÊç¢Áî®Êà∑">ÂàáÊç¢Áî®Êà∑</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">bool</span> <span class="hljs-title">switch_to_user</span><span class="hljs-params">(<span class="hljs-type">uid_t</span> user_id, <span class="hljs-type">gid_t</span> gp_id)</span> </span>{<br>    <span class="hljs-keyword">if</span> ((user_id == <span class="hljs-number">0</span>) &amp;&amp; (gp_id == <span class="hljs-number">0</span>)) {<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    }<br><br>    <span class="hljs-type">gid_t</span> gid = <span class="hljs-built_in">getgid</span>();<br>    <span class="hljs-type">uid_t</span> uid = <span class="hljs-built_in">getuid</span>();<br>    <span class="hljs-keyword">if</span> (((gid != <span class="hljs-number">0</span>) || (uid != <span class="hljs-number">0</span>)) &amp;&amp; ((gid != gp_id) || (uid != user_id))) {<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    }<br><br>    <span class="hljs-keyword">if</span> ((uid != <span class="hljs-number">0</span>) &amp;&amp; (uid == user_id)) {<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    }<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">setgid</span>(gp_id) &lt; <span class="hljs-number">0</span> || <span class="hljs-built_in">setuid</span>(user_id) &lt; <span class="hljs-number">0</span>) {<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    }<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>
<h4 id="ËøõÁ®ãÈó¥ÂÖ≥Á≥ª">ËøõÁ®ãÈó¥ÂÖ≥Á≥ª</h4>
<h5 id="ËøõÁ®ãÁªÑ">ËøõÁ®ãÁªÑ</h5>
<p>Linux ‰∏≠ÊØè‰∏™ËøõÁ®ãÈÉΩÂ±û‰∫é‰∏Ä‰∏™ËøõÁ®ãÁªÑÔºåËøõÁ®ãÁªÑ‰∏≠ÁöÑÈ¶ñÈ¢ÜËøõÁ®ãÊòØÁªÑÈïøÔºåËøõÁ®ãÁªÑ ID ‰∏éËøõÁ®ã ID Áõ∏Âêå</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">pid_t</span> <span class="hljs-title">getpgrp</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// Ëé∑ÂèñËøõÁ®ãÁªÑ ID</span><br><span class="hljs-function"><span class="hljs-type">pid_t</span> <span class="hljs-title">getpgid</span><span class="hljs-params">(<span class="hljs-type">pid_t</span> pid)</span></span>; <span class="hljs-comment">// Ëé∑ÂèñËøõÁ®ã ID ÁöÑËøõÁ®ãÁªÑ ID</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">setpgid</span><span class="hljs-params">(<span class="hljs-type">pid_t</span> pid, <span class="hljs-type">pid_t</span> pgid)</span></span>; <span class="hljs-comment">// ËÆæÁΩÆËøõÁ®ã ID ÁöÑËøõÁ®ãÁªÑ ID</span><br></code></pre></td></tr></tbody></table></figure>
<h5 id="‰ºöËØù">‰ºöËØù</h5>
<p>‰∏Ä‰∫õÊúâÂÖ≥ËÅîÁöÑËøõÁ®ãÁªÑÂèØ‰ª•ÁªÑÊàê‰∏Ä‰∏™‰ºöËØù</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-comment">// ÂàõÂª∫‰∏Ä‰∏™Êñ∞‰ºöËØù, ËøõÁ®ãÁªÑÁöÑÈ¶ñÈ¢ÜËøõÁ®ã‰∏çËÉΩË∞ÉÁî® setsid</span><br><span class="hljs-comment">// ÈùûÈ¶ñÈ¢ÜËøõÁ®ãË∞ÉÁî® setsid ‰ºöÂàõÂª∫‰∏Ä‰∏™Êñ∞‰ºöËØùÔºå‰∏îÊàê‰∏∫Êñ∞‰ºöËØùÁöÑÈ¶ñÈ¢ÜËøõÁ®ãÔºå‰∏î‰ºöÊñ∞Âª∫‰∏Ä‰∏™ËøõÁ®ãÁªÑÔºåÂÖ∂ PGID = PID = SID</span><br><span class="hljs-function"><span class="hljs-type">pid_t</span> <span class="hljs-title">setsid</span><span class="hljs-params">()</span></span>;<br></code></pre></td></tr></tbody></table></figure>
<h5 id="ps-ÂëΩ‰ª§">ps ÂëΩ‰ª§</h5>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -ef | grep xxx<br><br>ps -o pid,ppid,pgid,sid,comm | less<br></code></pre></td></tr></tbody></table></figure>
<h4 id="Á≥ªÁªüËµÑÊ∫êÈôêÂà∂">Á≥ªÁªüËµÑÊ∫êÈôêÂà∂</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/resource.h&gt;</span></span><br><br><span class="hljs-comment">// @param resource: ËµÑÊ∫êÁ±ªÂûã</span><br><span class="hljs-comment">// @param rlim: ËµÑÊ∫êÈôêÂà∂</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getrlimit</span><span class="hljs-params">(<span class="hljs-type">int</span> resource, <span class="hljs-keyword">struct</span> rlimit *rlim)</span></span>; <span class="hljs-comment">// Ëé∑ÂèñËµÑÊ∫êÈôêÂà∂ÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">setrlimit</span><span class="hljs-params">(<span class="hljs-type">int</span> resource, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> rlimit *rlim)</span></span>; <span class="hljs-comment">// ËÆæÁΩÆËµÑÊ∫êÈôêÂà∂ÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// rlimit ÁªìÊûÑ‰Ωì</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">rlimit</span> {<br>    <span class="hljs-type">rlim_t</span> rlim_cur; <span class="hljs-comment">// ËΩØÈôêÂà∂</span><br>    <span class="hljs-type">rlim_t</span> rlim_max; <span class="hljs-comment">// Á°¨ÈôêÂà∂</span><br>};<br><br><span class="hljs-comment">// ËµÑÊ∫êÁ±ªÂûã</span><br>RLIMIT_AS   <span class="hljs-comment">// ËøõÁ®ãÂú∞ÂùÄÁ©∫Èó¥Â§ßÂ∞è</span><br>RLIMIT_CORE <span class="hljs-comment">// core Êñá‰ª∂Â§ßÂ∞è</span><br>RLIMIT_CPU  <span class="hljs-comment">// CPU Êó∂Èó¥</span><br>RLIMIT_DATA <span class="hljs-comment">// Êï∞ÊçÆÊÆµÂ§ßÂ∞è</span><br>RLIMIT_FSIZE <span class="hljs-comment">// Êñá‰ª∂Â§ßÂ∞è</span><br>RLIMIT_MEMLOCK <span class="hljs-comment">// ÈîÅÂÆöÂÜÖÂ≠òÂ§ßÂ∞è</span><br>RLIMIT_MSGQUEUE <span class="hljs-comment">// Ê∂àÊÅØÈòüÂàóÂ§ßÂ∞è</span><br>RLIMIT_NICE <span class="hljs-comment">// ‰ºòÂÖàÁ∫ß</span><br>RLIMIT_NOFILE <span class="hljs-comment">// Êñá‰ª∂ÊèèËø∞Á¨¶Êï∞Èáè</span><br>RLIMIT_NPROC <span class="hljs-comment">// ËøõÁ®ãÊï∞Èáè</span><br>RLIMIT_RSS <span class="hljs-comment">// È©ªÁïôÂÜÖÂ≠òÂ§ßÂ∞è</span><br>RLIMIT_RTPRIO <span class="hljs-comment">// ÂÆûÊó∂‰ºòÂÖàÁ∫ß</span><br>RLIMIT_SIGPENDING <span class="hljs-comment">// ‰ø°Âè∑ÈòüÂàóÂ§ßÂ∞è</span><br>RLIMIT_STACK <span class="hljs-comment">// Ê†àÂ§ßÂ∞è</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="ÊîπÂèòÂ∑•‰ΩúÁõÆÂΩïÂíåÊ†πÁõÆÂΩï">ÊîπÂèòÂ∑•‰ΩúÁõÆÂΩïÂíåÊ†πÁõÆÂΩï</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">char</span> *<span class="hljs-title">getcwd</span><span class="hljs-params">(<span class="hljs-type">char</span> *buf, <span class="hljs-type">size_t</span> size)</span></span>; <span class="hljs-comment">// Ëé∑ÂèñÂΩìÂâçÂ∑•‰ΩúÁõÆÂΩïÔºåÊàêÂäüËøîÂõû bufÔºåÂ§±Ë¥•ËøîÂõû NULL</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">chdir</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path)</span></span>; <span class="hljs-comment">// ÊîπÂèòÂ∑•‰ΩúÁõÆÂΩïÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">chroot</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path)</span></span>; <span class="hljs-comment">// ÊîπÂèòÊ†πÁõÆÂΩïÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="ÊúçÂä°Âô®Á®ãÂ∫èÂêéÂè∞ÂåñÂÆàÊä§ËøõÁ®ãdaemon">ÊúçÂä°Âô®Á®ãÂ∫èÂêéÂè∞Âåñ(ÂÆàÊä§ËøõÁ®ãdaemon)</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">daemonize</span><span class="hljs-params">()</span> </span>{<br>    <span class="hljs-comment">// ÂàõÂª∫Â≠êËøõÁ®ãÔºåÁà∂ËøõÁ®ãÈÄÄÂá∫</span><br>    <span class="hljs-type">pid_t</span> pid = fork();<br>    <span class="hljs-keyword">if</span> (pid &lt; <span class="hljs-number">0</span>) {<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid &gt; <span class="hljs-number">0</span>) {<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    }<br><br>    <span class="hljs-comment">// ÂàõÂª∫Êñ∞‰ºöËØù</span><br>    <span class="hljs-built_in">setsid</span>();<br><br>    <span class="hljs-comment">// ÊîπÂèòÂ∑•‰ΩúÁõÆÂΩï</span><br>    <span class="hljs-built_in">chdir</span>(<span class="hljs-string">"/"</span>);<br><br>    <span class="hljs-comment">// ÂÖ≥Èó≠Êñá‰ª∂ÊèèËø∞Á¨¶</span><br>    <span class="hljs-built_in">close</span>(STDIN_FILENO);<br>    <span class="hljs-built_in">close</span>(STDOUT_FILENO);<br>    <span class="hljs-built_in">close</span>(STDERR_FILENO);<br><br>    <span class="hljs-comment">// ÈáçÂÆöÂêëÊñá‰ª∂ÊèèËø∞Á¨¶</span><br>    <span class="hljs-built_in">open</span>(<span class="hljs-string">"/dev/null"</span>, O_RDONLY);<br>    <span class="hljs-built_in">open</span>(<span class="hljs-string">"/dev/null"</span>, O_RDWR);<br>    <span class="hljs-built_in">open</span>(<span class="hljs-string">"/dev/null"</span>, O_RDWR);<br>}<br><br><span class="hljs-comment">// Linux ‰πüÊèê‰æõ‰∫Ü daemon ÂáΩÊï∞</span><br><span class="hljs-comment">// @param nochdir: 0: ÊîπÂèòÂ∑•‰ΩúÁõÆÂΩïÔºå1: ‰∏çÊîπÂèòÂ∑•‰ΩúÁõÆÂΩï</span><br><span class="hljs-comment">// @param noclose: 0: ÂÖ≥Èó≠Êñá‰ª∂ÊèèËø∞Á¨¶012(stdin,stdout,stderr)Ôºå1: ‰∏çÂÖ≥Èó≠</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">daemon</span><span class="hljs-params">(<span class="hljs-type">int</span> nochdir, <span class="hljs-type">int</span> noclose)</span></span>;<br></code></pre></td></tr></tbody></table></figure>
<h2 id="È´òÊÄßËÉΩÊúçÂä°Âô®Á®ãÂ∫èÊ°ÜÊû∂">È´òÊÄßËÉΩÊúçÂä°Âô®Á®ãÂ∫èÊ°ÜÊû∂</h2>
<p>‰∏ªË¶ÅÂàÜ‰∏∫‰∏âÈÉ®ÂàÜÔºö - I/O Â§ÑÁêÜÂçïÂÖÉÔºöÂåÖÂê´ÂõõÁßç I/O Ê®°Âûã‰ª•Âèä‰∏§ÁßçÈ´òÊïàÁöÑ‰∫ã‰ª∂Â§ÑÁêÜÊ®°Âûã - ÈÄªËæëÂçïÂÖÉÔºöÂåÖÂê´‰∏§ÁßçÈ´òÊïàÁöÑÂπ∂ÂèëÊ®°Âûã‰ª•ÂèäÈ´òÊïàÁöÑÈÄªËæëÂ§ÑÁêÜÊñπÂºè ‚Äî‚Äî ÊúâÈôêÁä∂ÊÄÅÊú∫(FSM) - Â≠òÂÇ®ÂçïÂÖÉÔºö(Áï•)</p>
<h4 id="ÊúçÂä°Âô®Ê®°Âûã">ÊúçÂä°Âô®Ê®°Âûã</h4>
<h5 id="cs-Ê®°Âûã-clientserver">C/S Ê®°Âûã (Client/Server)</h5>
<ul>
<li>ÊúçÂä°Âô®ÂÖàÂàõÂª∫Â§ö‰∏™ socketÔºåÁÑ∂ÂêéÁõëÂê¨Á´ØÂè£ÔºåÁ≠âÂæÖÂÆ¢Êà∑Á´ØËøûÊé• <img src="CS.png" srcset="/img/loading.gif" lazyload alt="CS"></li>
</ul>
<h5 id="p2p-Ê®°Âûã-peer-to-peer">P2P Ê®°Âûã (Peer to Peer)</h5>
<p><img src="P2P.png" srcset="/img/loading.gif" lazyload alt="P2P"> #### ÊúçÂä°Âô®ÁºñÁ®ãÊ°ÜÊû∂</p>
<div class="figure">
<img src="ServerFrame.png" srcset="/img/loading.gif" lazyload alt="ServerFrame">
<p class="caption">ServerFrame</p>
</div>
<ul>
<li>I/O Ê®°ÂùóÔºöÁ≠âÂæÖÂπ∂Êé•ÂèóÂÆ¢Êà∑Á´ØËøûÊé•ÔºåÊé•Êî∂ÂÆ¢Êà∑Á´ØÊï∞ÊçÆ(‰πüÂèØËÉΩÂú®ÈÄªËæëÂçïÂÖÉ‰∏≠ÔºåÂèñÂÜ≥‰∫é‰∫ã‰ª∂Â§ÑÁêÜÊ®°Âûã)ÔºåÂÆûÁé∞Ë¥üËΩΩÂùáË°°</li>
<li>ÈÄªËæëÂçïÂÖÉÔºöÂ§ÑÁêÜÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÔºåÂÆûÁé∞‰∏öÂä°ÈÄªËæëÔºåÈÄöÂ∏∏ÊòØ‰∏Ä‰∏™ËøõÁ®ãÊàñËÄÖÁ∫øÁ®ã</li>
<li>Â≠òÂÇ®ÂçïÂÖÉÔºöÂ≠òÂÇ®Êï∞ÊçÆÔºåÈÄöÂ∏∏ÊòØÊï∞ÊçÆÂ∫ìÊúçÂä°Âô®</li>
<li>ËØ∑Ê±ÇÈòüÂàóÔºöÊòØÂêÑÂçïÂÖÉÈÄö‰ø°ÊñπÂºèÁöÑÊäΩË±°ÔºåÊòØÂêÑÊúçÂä°Âô®‰πãÈó¥È¢ÑÂÖàÂª∫Á´ãÁöÑ„ÄÅÈùôÊÄÅÁöÑ„ÄÅÊ∞∏‰πÖÁöÑ TCP ËøûÊé•ÔºåÈÄöÂ∏∏Ë¢´ÂÆûÁé∞‰∏∫Ê±†ÁöÑ‰∏ÄÈÉ®ÂàÜ</li>
</ul>
<h4 id="io-Ê®°Âûã">I/O Ê®°Âûã</h4>
<p>socket ÈªòËÆ§ÊòØÈòªÂ°ûÁöÑÔºåÂèØ‰ª•ÈÄöËøáËÆæÁΩÆ O_NONBLOCK ÈÄâÈ°πÊù•ËÆæÁΩÆÈùûÈòªÂ°ûÔºåÂèØËÉΩË¢´ÈòªÂ°ûÁöÑÁ≥ªÁªüË∞ÉÁî®ÊúâÔºö - accept - recv - send - connect</p>
<p>ÂØπ‰∫éÈùûÈòªÂ°ûÁöÑ socketÔºåÊÄªÊòØÁ´ãÂç≥ËøîÂõûÔºåÂèØËÉΩËøîÂõû EAGAIN Êàñ EWOULDBLOCK ÈîôËØØ(ÈùûÈòªÂ°ûÈÄöÂ∏∏ÈÖçÂêà IO Â§çÁî®‰ª•Âèä SIGIO ‰ø°Âè∑‰ΩøÁî®) <img src="IOModel.png" srcset="/img/loading.gif" lazyload alt="IOModel"></p>
<h4 id="È´òÊïàÁöÑ‰∫ã‰ª∂Â§ÑÁêÜÊ®°Âûã">È´òÊïàÁöÑ‰∫ã‰ª∂Â§ÑÁêÜÊ®°Âûã</h4>
<h5 id="reactor-Ê®°Âºè">Reactor Ê®°Âºè</h5>
<p>Ë¶ÅÊ±Ç‰∏ªÁ∫øÁ®ã(Reactor)Ë¥üË¥£‰∏îÂè™Ë¥üË¥£ÁõëÂê¨Êñá‰ª∂ÊèèËø∞Á¨¶ÁöÑ‰∫ã‰ª∂ÔºåÁÆ°ÁêÜËØ∑Ê±ÇÈòüÂàóÔºåÈô§Ê≠§‰πãÂ§ñÔºå‰∏ªÁ∫øÁ®ã‰∏çÂÅö‰ªª‰ΩïÂÆûË¥®ÊÄßÁöÑÂ∑•‰ΩúÔºåÂ∞ÜËØªÂÜôÁöÑÂ∑•‰ΩúÂàÜÈÖçÁªôÂ∑•‰ΩúÁ∫øÁ®ã(ÂèëÂá∫ÁöÑÊòØÂÜôÂ∞±Áª™‰∫ã‰ª∂)</p>
<p>‰∏ãÈù¢‰ª•ÂêåÊ≠• I/O Â§öË∑ØÂ§çÁî® <code>epoll_wait</code> ‰∏∫‰æãÔºåÂÆûÁé∞ Reactor Ê®°ÂºèÊ°ÜÊû∂</p>
<div class="figure">
<img src="Reactor.png" srcset="/img/loading.gif" lazyload alt="Reactor">
<p class="caption">Reactor</p>
</div>
<h5 id="proactor-Ê®°Âºè">Proactor Ê®°Âºè</h5>
<p>Proactor Ê®°ÂºèË¶ÅÊ±Ç‰∏ªÁ∫øÁ®ã(Proactor)ÂíåÂÜÖÊ†∏Ë¥üË¥£Â§ÑÁêÜÊâÄÊúâÁöÑ I/O ‰∫ã‰ª∂ÔºåËÄåÂ∑•‰ΩúÁ∫øÁ®ãÂè™Ë¥üË¥£‰∏öÂä°ÈÄªËæë(ÂèëÂá∫ÁöÑÊòØÂÜôÂÆåÊàê‰∫ã‰ª∂)</p>
<p>‰∏ãÈù¢‰ª•ÂºÇÊ≠• I/O <code>aio_read, aio_write</code> ‰∏∫‰æãÔºåÂÆûÁé∞ Proactor Ê®°ÂºèÊ°ÜÊû∂</p>
<div class="figure">
<img src="Proactor.png" srcset="/img/loading.gif" lazyload alt="Proactor">
<p class="caption">Proactor</p>
</div>
<h4 id="È´òÊïàÁöÑÂπ∂ÂèëÊ®°Âûã">È´òÊïàÁöÑÂπ∂ÂèëÊ®°Âûã</h4>
<h5 id="ÂçäÂêåÊ≠•ÂçäÂºÇÊ≠•Ê®°Âûãhalf-synchalf-async">ÂçäÂêåÊ≠•/ÂçäÂºÇÊ≠•Ê®°Âûã(Half Sync/Half Async)</h5>
<p>Âú® I/O Ê®°Âûã‰∏≠ÁöÑÂêåÊ≠•‰∏éÂºÇÊ≠•ÔºåÊòØÊåá I/O Êìç‰ΩúÁöÑÂêåÊ≠•‰∏éÂºÇÊ≠•(‰ª•Â∞±Áª™‰∫ã‰ª∂ËøòÊòØÂÆåÊàê‰∫ã‰ª∂‰ª•ÂèäË∞ÅÊù•ÂÆåÊàê I/O ËØªÂÜô‰∏∫Ê†áÂáÜ)ÔºåËÄåÂú®Âπ∂ÂèëÊ®°Âûã‰∏≠ÁöÑÂêåÊ≠•‰∏éÂºÇÊ≠•‰∏çÂêåÔºåÂêåÊ≠•ÊòØÊåáÁ®ãÂ∫èÂÆåÂÖ®ÊåâÁÖß‰ª£Á†ÅÈ°∫Â∫èÊâßË°åÔºåÂºÇÊ≠•ÊòØÊåáÁ®ãÂ∫è‰∏çÊåâÁÖß‰ª£Á†ÅÈ°∫Â∫èÊâßË°å(ÈúÄË¶ÅÁ≥ªÁªü‰∫ã‰ª∂Ëß¶ÂèëÈ©±Âä®ÔºåÂ¶Ç‰∏≠Êñ≠„ÄÅ‰ø°Âè∑Á≠â)</p>
<div class="figure">
<img src="HSHA.png" srcset="/img/loading.gif" lazyload alt="HSHA">
<p class="caption">HSHA</p>
</div>
<p>ËÄåÂçäÂêåÊ≠•/ÂçäÂºÇÊ≠•Ê®°ÂûãÂàôÊòØÂ∞ÜÂêåÊ≠•ÂíåÂºÇÊ≠•ÁªìÂêàËµ∑Êù•ÔºåÂºÇÊ≠•Á∫øÁ®ãË¥üË¥£ I/O ‰∫ã‰ª∂ÁöÑÂ§ÑÁêÜÂπ∂ÊèíÂÖ•ËØ∑Ê±ÇÈòüÂàóÔºåÂêåÊ≠•Á∫øÁ®ãË¥üË¥£‰∏öÂä°ÈÄªËæëÁöÑÂ§ÑÁêÜ</p>
<div class="figure">
<img src="HSHAwork.png" srcset="/img/loading.gif" lazyload alt="HSHAwork">
<p class="caption">HSHAwork</p>
</div>
<p>Â¶Ç‰∏ãÊòØÂçäÂêåÊ≠•/ÂçäÂèçÂ∫îÂ†ÜÊ®°ÂûãÁöÑÊ°ÜÊû∂</p>
<div class="figure">
<img src="HSHR.png" srcset="/img/loading.gif" lazyload alt="HSHR">
<p class="caption">HSHR</p>
</div>
<h5 id="È¢ÜÂØºËÄÖËøΩÈöèËÄÖÊ®°Âûãleaderfollower">È¢ÜÂØºËÄÖ/ËøΩÈöèËÄÖÊ®°Âûã(Leader/Follower)</h5>
<p>È¢ÜÂØºËÄÖ/ËøΩÈöèËÄÖÊ®°ÂûãÊòØ‰∏ÄÁßçÈ´òÊïàÁöÑÂπ∂ÂèëÊ®°ÂûãÔºåÈ¢ÜÂØºËÄÖË¥üË¥£ÁõëÂê¨Êñá‰ª∂ÊèèËø∞Á¨¶ÁöÑ‰∫ã‰ª∂ÔºåËøΩÈöèËÄÖË¥üË¥£Â§ÑÁêÜ‰∏öÂä°ÈÄªËæëÔºåÈ¢ÜÂØºËÄÖÂíåËøΩÈöèËÄÖ‰πãÈó¥ÈÄöËøáÁ∫øÁ®ãÊ±†ËøõË°åÈÄö‰ø°Ôºå‰∫åËÄÖ‰πãÈó¥ÂèØ‰ª•Áõ∏‰∫íÂàáÊç¢Ôºå‰ª•ÂÆûÁé∞Ë¥üËΩΩÂùáË°°</p>
<div class="figure">
<img src="LF1.png" srcset="/img/loading.gif" lazyload alt="LF1">
<p class="caption">LF1</p>
</div>
<div class="figure">
<img src="LF2.png" srcset="/img/loading.gif" lazyload alt="LF2">
<p class="caption">LF2</p>
</div>
<h4 id="ÊúâÈôêÁä∂ÊÄÅÊú∫fsm">ÊúâÈôêÁä∂ÊÄÅÊú∫(FSM)</h4>
<p>ËØ¶ÊÉÖ‰ª•ÂèäËøõ‰∏ÄÊ≠•ÊãìÂ±ïÂèØ‰ª•ÂèÇËÄÉËØæÁ®ã<a target="_blank" rel="noopener" href="https://fla24course.github.io/">Formal Language and Automata</a></p>
<h2 id="io-Â§çÁî®">I/O Â§çÁî®</h2>
<h4 id="select-Á≥ªÁªüË∞ÉÁî®">select Á≥ªÁªüË∞ÉÁî®</h4>
<h5 id="select-api">select API</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/select.h&gt;</span></span><br><span class="hljs-comment">// @return: Â∞±Áª™(ÂèØËØªÔºå ÂèØÂÜôÔºå ÂºÇÂ∏∏)Êñá‰ª∂ÊèèËø∞Á¨¶Êï∞</span><br><span class="hljs-comment">// @param nfds: Êñá‰ª∂ÊèèËø∞Á¨¶ÊúÄÂ§ßÂÄº + 1</span><br><span class="hljs-comment">// @param readfds: ËØªÊñá‰ª∂ÊèèËø∞Á¨¶ÈõÜÂêà</span><br><span class="hljs-comment">// @param writefds: ÂÜôÊñá‰ª∂ÊèèËø∞Á¨¶ÈõÜÂêà</span><br><span class="hljs-comment">// @param exceptfds: ÂºÇÂ∏∏Êñá‰ª∂ÊèèËø∞Á¨¶ÈõÜÂêà</span><br><span class="hljs-comment">// @param timeout: Ë∂ÖÊó∂Êó∂Èó¥</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">select</span><span class="hljs-params">(<span class="hljs-type">int</span> nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, <span class="hljs-keyword">struct</span> timeval *timeout)</span></span>; <span class="hljs-comment">// Â§öË∑ØÂ§çÁî®ÔºåÊàêÂäüËøîÂõûÂ∞±Áª™Êñá‰ª∂ÊèèËø∞Á¨¶Êï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// fd_set ÁªìÊûÑ‰Ωì</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;typesizes.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __FD_SETSIZE 1024</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">int</span> __fd_mask;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __NFDBITS (8 * (int)sizeof(__fd_mask))</span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> {<br>    __fd_mask __fds_bits[__FD_SETSIZE / __NFDBITS];<br>} fd_set;<br><br><span class="hljs-built_in">FD_ZERO</span>(fd_set *fdset); <span class="hljs-comment">// Ê∏ÖÁ©∫Êñá‰ª∂ÊèèËø∞Á¨¶ÈõÜÂêà</span><br><span class="hljs-built_in">FD_SET</span>(<span class="hljs-type">int</span> fd, fd_set *fdset); <span class="hljs-comment">// Ê∑ªÂä†Êñá‰ª∂ÊèèËø∞Á¨¶Âà∞ÈõÜÂêà</span><br><span class="hljs-built_in">FD_CLR</span>(<span class="hljs-type">int</span> fd, fd_set *fdset); <span class="hljs-comment">// ‰ªéÈõÜÂêà‰∏≠Âà†Èô§Êñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-built_in">FD_ISSET</span>(<span class="hljs-type">int</span> fd, fd_set *fdset); <span class="hljs-comment">// Âà§Êñ≠Êñá‰ª∂ÊèèËø∞Á¨¶ÊòØÂê¶Âú®ÈõÜÂêà‰∏≠</span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">timeval</span> {<br>    <span class="hljs-type">long</span> tv_sec; <span class="hljs-comment">// Áßí</span><br>    <span class="hljs-type">long</span> tv_usec; <span class="hljs-comment">// ÂæÆÁßí</span><br>};<br></code></pre></td></tr></tbody></table></figure>
<div class="figure">
<img src="FDReadyCondition.png" srcset="/img/loading.gif" lazyload alt="FDReadyCondition">
<p class="caption">FDReadyCondition</p>
</div>
<h4 id="poll-Á≥ªÁªüË∞ÉÁî®">poll Á≥ªÁªüË∞ÉÁî®</h4>
<ul>
<li>poll ‰∏é select Á±ª‰ººÔºå‰πüÊòØÂú®ÊåáÂÆöÊó∂Èó¥ÂÜÖËΩÆËØ¢‰∏ÄÁªÑÊñá‰ª∂ÊèèËø∞Á¨¶Ôºå‰ª•Ê£ÄÊµãÊòØÂê¶ÊúâÂ∞±Áª™‰∫ã‰ª∂ÂèëÁîü</li>
<li>poll ‰∏é select ÁöÑÂå∫Âà´Ôºö
<ul>
<li>poll Ê≤°ÊúâÊñá‰ª∂ÊèèËø∞Á¨¶Êï∞ÈáèÈôêÂà∂</li>
<li>poll ÈÄöËøá pollfd ÁªìÊûÑ‰Ωì‰º†ÈÄíÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåËÄå‰∏çÊòØÈÄöËøá fd_set</li>
<li>poll ÈÄöËøá‰∫ã‰ª∂Á±ªÂûãÊù•Âà§Êñ≠Êñá‰ª∂ÊèèËø∞Á¨¶ÊòØÂê¶Â∞±Áª™ÔºåËÄå‰∏çÊòØÈÄöËøá‰ΩçÂõæ</li>
<li>poll ÈÄöËøá pollfd ÁªìÊûÑ‰ΩìÁöÑ revents ÊàêÂëòÊù•Âà§Êñ≠Êñá‰ª∂ÊèèËø∞Á¨¶ÊòØÂê¶Â∞±Áª™ÔºåËÄå‰∏çÊòØÈÄöËøáËøîÂõûÂÄº</li>
</ul></li>
</ul>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-comment">// @return: Â∞±Áª™Êñá‰ª∂ÊèèËø∞Á¨¶Êï∞Ôºå‰∏é select ‰∏ÄËá¥</span><br><span class="hljs-comment">// @param fds: pollfd ÁªìÊûÑ‰ΩìÊï∞ÁªÑ</span><br><span class="hljs-comment">// @param nfds: pollfd ÁªìÊûÑ‰ΩìÊï∞ÁªÑÈïøÂ∫¶</span><br><span class="hljs-comment">// @param timeout: Ë∂ÖÊó∂Êó∂Èó¥</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">poll</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> pollfd *fds, <span class="hljs-type">nfds_t</span> nfds, <span class="hljs-type">int</span> timeout)</span></span>; <span class="hljs-comment">// Â§öË∑ØÂ§çÁî®ÔºåÊàêÂäüËøîÂõûÂ∞±Áª™Êñá‰ª∂ÊèèËø∞Á¨¶Êï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// pollfd ÁªìÊûÑ‰Ωì</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">pollfd</span> {<br>    <span class="hljs-type">int</span> fd; <span class="hljs-comment">// Êñá‰ª∂ÊèèËø∞Á¨¶</span><br>    <span class="hljs-type">short</span> events; <span class="hljs-comment">// ‰∫ã‰ª∂Á±ªÂûã</span><br>    <span class="hljs-type">short</span> revents; <span class="hljs-comment">// Â∞±Áª™‰∫ã‰ª∂</span><br>};<br><br><span class="hljs-comment">// ‰∫ã‰ª∂Á±ªÂûã</span><br>POLLIN  <span class="hljs-comment">// ÂèØËØª</span><br>POLLRDNORM <span class="hljs-comment">// ÊôÆÈÄöÊï∞ÊçÆÂèØËØª</span><br>POLLRDBAND <span class="hljs-comment">// ‰ºòÂÖàÁ∫ßÊï∞ÊçÆÂèØËØª</span><br>POLLPRI <span class="hljs-comment">// È´ò‰ºòÂÖàÁ∫ßÊï∞ÊçÆÂèØËØª</span><br>POLLOUT <span class="hljs-comment">// ÂèØÂÜô</span><br>POLLWRNORM <span class="hljs-comment">// ÊôÆÈÄöÊï∞ÊçÆÂèØÂÜô</span><br>POLLWRBAND <span class="hljs-comment">// ‰ºòÂÖàÁ∫ßÊï∞ÊçÆÂèØÂÜô</span><br>POLLERR <span class="hljs-comment">// ÂºÇÂ∏∏</span><br>POLLHUP <span class="hljs-comment">// ÊåÇËµ∑</span><br>POLLNVAL <span class="hljs-comment">// Êó†Êïà</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="epoll-Á≥ªÁªüË∞ÉÁî®">epoll Á≥ªÁªüË∞ÉÁî®</h4>
<h5 id="ÂÜÖÊ†∏‰∫ã‰ª∂Ë°®">ÂÜÖÊ†∏‰∫ã‰ª∂Ë°®</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/epoll.h&gt;</span></span><br><span class="hljs-comment">// @return: ÂÜÖÊ†∏‰∫ã‰ª∂Ë°®ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param size: ÂÜÖÊ†∏‰∫ã‰ª∂Ë°®ÁöÑÂ§ßÂ∞è</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">epoll_create</span><span class="hljs-params">(<span class="hljs-type">int</span> size)</span></span>; <span class="hljs-comment">// ÂàõÂª∫ÂÜÖÊ†∏‰∫ã‰ª∂Ë°®ÔºåÊàêÂäüËøîÂõûÂÜÖÊ†∏‰∫ã‰ª∂Ë°®ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// @param epfd: ÂÜÖÊ†∏‰∫ã‰ª∂Ë°®ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param op: EPOLL_CTL_ADD(Ê∑ªÂä†‰∫ã‰ª∂), EPOLL_CTL_MOD(‰øÆÊîπ‰∫ã‰ª∂), EPOLL_CTL_DEL(Âà†Èô§‰∫ã‰ª∂)</span><br><span class="hljs-comment">// @param fd: Ë¶ÅÊìç‰ΩúÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param event: epoll_event ÁªìÊûÑ‰Ωì</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">epoll_ctl</span><span class="hljs-params">(<span class="hljs-type">int</span> epfd, <span class="hljs-type">int</span> op, <span class="hljs-type">int</span> fd, <span class="hljs-keyword">struct</span> epoll_event *event)</span></span>; <span class="hljs-comment">// ÊéßÂà∂ÂÜÖÊ†∏‰∫ã‰ª∂Ë°®ÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// epoll_event ÁªìÊûÑ‰Ωì</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">epoll_event</span> {<br>    <span class="hljs-type">uint32_t</span> events; <span class="hljs-comment">// ‰∫ã‰ª∂Á±ªÂûã</span><br>    <span class="hljs-type">epoll_data_t</span> data; <span class="hljs-comment">// Áî®Êà∑Êï∞ÊçÆ</span><br>};<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">union</span> <span class="hljs-title class_">epoll_data</span> {<br>    <span class="hljs-type">void</span> *ptr;<br>    <span class="hljs-type">int</span> fd;<br>    <span class="hljs-type">uint32_t</span> u32;<br>    <span class="hljs-type">uint64_t</span> u64;<br>} <span class="hljs-type">epoll_data_t</span>;<br></code></pre></td></tr></tbody></table></figure>
<h5 id="epoll_wait-api">epoll_wait API</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/epoll.h&gt;</span></span><br><span class="hljs-comment">// @return: Â∞±Áª™Êñá‰ª∂ÊèèËø∞Á¨¶Êï∞</span><br><span class="hljs-comment">// @param epfd: ÂÜÖÊ†∏‰∫ã‰ª∂Ë°®ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶</span><br><span class="hljs-comment">// @param events: epoll_event ÁªìÊûÑ‰ΩìÊï∞ÁªÑ</span><br><span class="hljs-comment">// @param maxevents: epoll_event ÁªìÊûÑ‰ΩìÊï∞ÁªÑÈïøÂ∫¶</span><br><span class="hljs-comment">// @param timeout: Ë∂ÖÊó∂Êó∂Èó¥</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">epoll_wait</span><span class="hljs-params">(<span class="hljs-type">int</span> epfd, <span class="hljs-keyword">struct</span> epoll_event *events, <span class="hljs-type">int</span> maxevents, <span class="hljs-type">int</span> timeout)</span></span>; <span class="hljs-comment">// Â§öË∑ØÂ§çÁî®ÔºåÊàêÂäüËøîÂõûÂ∞±Áª™Êñá‰ª∂ÊèèËø∞Á¨¶Êï∞ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h5 id="lt-Ê®°ÂºèÂíå-et-Ê®°Âºè">LT Ê®°ÂºèÂíå ET Ê®°Âºè</h5>
<p>epoll ÈªòËÆ§ÂêØÁî® LT Ê®°ÂºèÔºåÂΩìÂêëÂÜÖÊ†∏‰∫ã‰ª∂Ë°®Ê≥®ÂÜå EPOLLET ‰∫ã‰ª∂Êó∂ÔºåÂêØÁî® ET Ê®°Âºè(ËæπÁºòËß¶ÂèëÊ®°Âºè) </p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">events.events = EPOLLIN | EPOLLET;<br></code></pre></td></tr></tbody></table></figure><p></p>
<h5 id="epolloneshot">EPOLLONESHOT</h5>
<p>epoll ÈªòËÆ§‰∏çÂêØÁî® EPOLLONESHOT ‰∫ã‰ª∂ÔºåÂΩìÂêëÂÜÖÊ†∏‰∫ã‰ª∂Ë°®Ê≥®ÂÜå EPOLLONESHOT ‰∫ã‰ª∂Êó∂ÔºåË°®Á§∫Âè™Ëß¶Âèë‰∏ÄÊ¨°ÔºåÈúÄË¶ÅÈáçÊñ∞Ê≥®ÂÜå </p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">events.events = EPOLLIN | EPOLLONESHOT;<br></code></pre></td></tr></tbody></table></figure><p></p>
<h4 id="select-poll-epoll-ÊÄßËÉΩÊØîËæÉ">select, poll, epoll ÊÄßËÉΩÊØîËæÉ</h4>
<div class="figure">
<img src="IOCmp.png" srcset="/img/loading.gif" lazyload alt="IOCmp">
<p class="caption">IOCmp</p>
</div>
<h2 id="‰ø°Âè∑">‰ø°Âè∑</h2>
<h4 id="linux-‰ø°Âè∑Ê¶ÇËø∞">Linux ‰ø°Âè∑Ê¶ÇËø∞</h4>
<h5 id="ÂèëÈÄÅ‰ø°Âè∑">ÂèëÈÄÅ‰ø°Âè∑</h5>
<ul>
<li>kill ÂëΩ‰ª§(‰∏Ä‰∏™ËøõÁ®ãÂêëÂè¶‰∏Ä‰∏™ËøõÁ®ãÂèëÈÄÅ‰ø°Âè∑)</li>
</ul>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-comment">// @param pid: ËøõÁ®ã ID</span><br><span class="hljs-comment">// pid &gt; 0: ÂèëÈÄÅ‰ø°Âè∑ÁªôÊåáÂÆöËøõÁ®ã</span><br><span class="hljs-comment">// pid = 0: ÂèëÈÄÅ‰ø°Âè∑ÁªôÂΩìÂâçËøõÁ®ãÊâÄÂú®ËøõÁ®ãÁªÑ‰∏≠ÁöÑÊâÄÊúâËøõÁ®ã</span><br><span class="hljs-comment">// pid = -1: ÂèëÈÄÅ‰ø°Âè∑ÁªôÊâÄÊúâÊúâÊùÉÈôêÁöÑËøõÁ®ã(Èô§‰∫Ü init ËøõÁ®ã)</span><br><span class="hljs-comment">// pid &lt; -1: ÂèëÈÄÅ‰ø°Âè∑ÁªôÊåáÂÆöËøõÁ®ãÁªÑ(-pid)‰∏≠ÁöÑÊâÄÊúâËøõÁ®ã</span><br><span class="hljs-comment">// @param sig: ‰ø°Âè∑</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">kill</span><span class="hljs-params">(<span class="hljs-type">pid_t</span> pid, <span class="hljs-type">int</span> sig)</span></span>; <span class="hljs-comment">// ÂèëÈÄÅ‰ø°Âè∑ÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<ul>
<li><code>kill</code> ÁöÑ errno Â¶Ç‰∏ãÔºö</li>
<li>EPERM: ÊùÉÈôê‰∏çË∂≥</li>
<li>ESRCH: ËøõÁ®ã‰∏çÂ≠òÂú®</li>
<li>EINVAL: ‰ø°Âè∑‰∏çÂêàÊ≥ï</li>
</ul>
<h5 id="‰ø°Âè∑Â§ÑÁêÜÊñπÂºè">‰ø°Âè∑Â§ÑÁêÜÊñπÂºè</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-comment">// @param int ÊåáÁ§∫‰ø°Âè∑Á±ªÂûã</span><br><span class="hljs-comment">// ‰ø°Âè∑Â§ÑÁêÜÂáΩÊï∞</span><br><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">void</span> <span class="hljs-params">(*<span class="hljs-type">sighandler_t</span>)</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span></span>;<br></code></pre></td></tr></tbody></table></figure>
<h5 id="linux-‰ø°Âè∑">Linux ‰ø°Âè∑</h5>
<!--‰∏ãÈù¢ÁªôÂá∫Ë°®Ê†º  ‰ø°Âè∑|Ëµ∑Ê∫ê|ÈªòËÆ§Ë°å‰∏∫|Âê´‰πâ-->
<table>
<thead>
<tr class="header">
<th>‰ø°Âè∑</th>
<th>Ëµ∑Ê∫ê</th>
<th>ÈªòËÆ§Ë°å‰∏∫</th>
<th>Âê´‰πâ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SIGHUP</td>
<td>POSIX</td>
<td>Term</td>
<td>ÁªàÁ´ØÊåÇËµ∑ÊàñÊéßÂà∂ËøõÁ®ãÁªàÊ≠¢</td>
</tr>
<tr class="even">
<td>SIGINT</td>
<td>ANSI</td>
<td>Term</td>
<td>‰∏≠Êñ≠‰ø°Âè∑</td>
</tr>
<tr class="odd">
<td>SIGQUIT</td>
<td>POSIX</td>
<td>Core</td>
<td>ÈÄÄÂá∫‰ø°Âè∑</td>
</tr>
<tr class="even">
<td>SIGILL</td>
<td>ANSI</td>
<td>Core</td>
<td>ÈùûÊ≥ïÊåá‰ª§</td>
</tr>
<tr class="odd">
<td>SIGTRAP</td>
<td>POSIX</td>
<td>Core</td>
<td>Ë∑üË∏™/Êñ≠ÁÇπÈô∑Èò±</td>
</tr>
<tr class="even">
<td>SIGABRT</td>
<td>ANSI</td>
<td>Core</td>
<td>ÂºÇÂ∏∏ÁªàÊ≠¢</td>
</tr>
<tr class="odd">
<td>SIGIOT</td>
<td>4.2BSD</td>
<td>Core</td>
<td>IOT Êåá‰ª§</td>
</tr>
<tr class="even">
<td>SIGBUS</td>
<td>4.2BSD</td>
<td>Core</td>
<td>ÊÄªÁ∫øÈîôËØØ</td>
</tr>
<tr class="odd">
<td>SIGFPE</td>
<td>ANSI</td>
<td>Core</td>
<td>ÊµÆÁÇπÂºÇÂ∏∏</td>
</tr>
<tr class="even">
<td>SIGKILL</td>
<td>POSIX</td>
<td>Term</td>
<td>Âº∫Âà∂ÁªàÊ≠¢</td>
</tr>
<tr class="odd">
<td>SIGUSR1</td>
<td>POSIX</td>
<td>Term</td>
<td>Áî®Êà∑Ëá™ÂÆö‰πâ‰ø°Âè∑ 1</td>
</tr>
<tr class="even">
<td>SIGSEGV</td>
<td>ANSI</td>
<td>Core</td>
<td>ÊÆµÈîôËØØ</td>
</tr>
<tr class="odd">
<td>SIGUSR2</td>
<td>POSIX</td>
<td>Term</td>
<td>Áî®Êà∑Ëá™ÂÆö‰πâ‰ø°Âè∑ 2</td>
</tr>
<tr class="even">
<td>SIGPIPE</td>
<td>POSIX</td>
<td>Term</td>
<td>ÁÆ°ÈÅìÁ†¥Ë£Ç</td>
</tr>
<tr class="odd">
<td>SIGALRM</td>
<td>POSIX</td>
<td>Term</td>
<td>ÈóπÈíü‰ø°Âè∑</td>
</tr>
<tr class="even">
<td>SIGTERM</td>
<td>ANSI</td>
<td>Term</td>
<td>ÁªàÊ≠¢‰ø°Âè∑</td>
</tr>
<tr class="odd">
<td>SIGSTKFLT</td>
<td>Linux</td>
<td>Term</td>
<td>ÂçèÂ§ÑÁêÜÂô®Ê†àÈîôËØØ</td>
</tr>
<tr class="even">
<td>SIGCHLD</td>
<td>POSIX</td>
<td>Ign</td>
<td>Â≠êËøõÁ®ãÁä∂ÊÄÅÊîπÂèò</td>
</tr>
<tr class="odd">
<td>SIGCONT</td>
<td>POSIX</td>
<td>Cont</td>
<td>ÁªßÁª≠ÊâßË°å</td>
</tr>
<tr class="even">
<td>SIGSTOP</td>
<td>POSIX</td>
<td>Stop</td>
<td>ÂÅúÊ≠¢ËøõÁ®ã</td>
</tr>
<tr class="odd">
<td>SIGTSTP</td>
<td>POSIX</td>
<td>Stop</td>
<td>ÁªàÁ´ØÂÅúÊ≠¢‰ø°Âè∑</td>
</tr>
<tr class="even">
<td>SIGTTIN</td>
<td>POSIX</td>
<td>Stop</td>
<td>ÂêéÂè∞ËøõÁ®ãËØ∑Ê±ÇËæìÂÖ•</td>
</tr>
<tr class="odd">
<td>SIGTTOU</td>
<td>POSIX</td>
<td>Stop</td>
<td>ÂêéÂè∞ËøõÁ®ãËØ∑Ê±ÇËæìÂá∫</td>
</tr>
<tr class="even">
<td>SIGURG</td>
<td>4.2BSD</td>
<td>Ign</td>
<td>Á¥ßÊÄ•Êù°‰ª∂</td>
</tr>
<tr class="odd">
<td>SIGXCPU</td>
<td>4.2BSD</td>
<td>Core</td>
<td>Ë∂ÖËøá CPU Êó∂Èó¥ÈôêÂà∂</td>
</tr>
<tr class="even">
<td>SIGXFSZ</td>
<td>4.2BSD</td>
<td>Core</td>
<td>Ë∂ÖËøáÊñá‰ª∂Â§ßÂ∞èÈôêÂà∂</td>
</tr>
<tr class="odd">
<td>SIGVTALRM</td>
<td>4.2BSD</td>
<td>Term</td>
<td>ËôöÊãüÊó∂Èíü‰ø°Âè∑</td>
</tr>
<tr class="even">
<td>SIGPROF</td>
<td>4.2BSD</td>
<td>Term</td>
<td>‰∏ìÁî®Êó∂Èíü‰ø°Âè∑</td>
</tr>
<tr class="odd">
<td>SIGWINCH</td>
<td>4.3BSD</td>
<td>Ign</td>
<td>Á™óÂè£Â§ßÂ∞èÊîπÂèò</td>
</tr>
<tr class="even">
<td>SIGIO</td>
<td>4.2BSD</td>
<td>Term</td>
<td>I/O ÂèØÁî®</td>
</tr>
<tr class="odd">
<td>SIGPWR</td>
<td>System V</td>
<td>Term</td>
<td>ÁîµÊ∫êÊïÖÈöú</td>
</tr>
<tr class="even">
<td>SIGSYS</td>
<td>4.2BSD</td>
<td>Core</td>
<td>ÈùûÊ≥ïÁ≥ªÁªüË∞ÉÁî®</td>
</tr>
<tr class="odd">
<td>SIGRTMIN</td>
<td>Linux</td>
<td>Term</td>
<td>ÂÆûÊó∂‰ø°Âè∑ÁöÑÊúÄÂ∞èÂÄº</td>
</tr>
<tr class="even">
<td>SIGRTMAX</td>
<td>Linux</td>
<td>Term</td>
<td>ÂÆûÊó∂‰ø°Âè∑ÁöÑÊúÄÂ§ßÂÄº</td>
</tr>
<tr class="odd">
<td>SIGUNUSED</td>
<td>Linux</td>
<td>Term</td>
<td>‰øùÁïôÊú™‰ΩøÁî®</td>
</tr>
</tbody>
</table>
<ul>
<li>‰ΩÜÁõÆÂâçÁΩëÁªúÁºñÁ®ã‰∏ªË¶ÅÂÖ≥Ê≥®ÁöÑ‰ø°Âè∑Êúâ SIGHUP, SIGURG, SIGPIPE, SIGALRM, SIGCHID</li>
</ul>
<h4 id="‰ø°Âè∑ÂáΩÊï∞">‰ø°Âè∑ÂáΩÊï∞</h4>
<h5 id="signal-Á≥ªÁªüË∞ÉÁî®">signal Á≥ªÁªüË∞ÉÁî®</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-comment">// @param signum: ‰ø°Âè∑</span><br><span class="hljs-function"><span class="hljs-type">_sighandler_t</span> <span class="hljs-title">signal</span><span class="hljs-params">(<span class="hljs-type">int</span> signum, <span class="hljs-type">_sighandler_t</span> handler)</span></span>; <span class="hljs-comment">// ËÆæÁΩÆ‰ø°Âè∑Â§ÑÁêÜÂáΩÊï∞ÔºåÊàêÂäüËøîÂõûÂéüÊù•ÁöÑ‰ø°Âè∑Â§ÑÁêÜÂáΩÊï∞ÔºåÂ§±Ë¥•ËøîÂõû SIG_ERR</span><br><br><span class="hljs-comment">// signal ÂáΩÊï∞ÁöÑËøîÂõûÂÄºÁ±ªÂûã</span><br><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">void</span> <span class="hljs-params">(*<span class="hljs-type">_sighandler_t</span>)</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span></span>;<br></code></pre></td></tr></tbody></table></figure>
<h5 id="sigaction-Á≥ªÁªüË∞ÉÁî®">sigaction Á≥ªÁªüË∞ÉÁî®</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-comment">// @param signum: ‰ø°Âè∑</span><br><span class="hljs-comment">// @param act: ‰ø°Âè∑Â§ÑÁêÜÊñπÂºè</span><br><span class="hljs-comment">// @param oldact: ÊóßÁöÑ‰ø°Âè∑Â§ÑÁêÜÊñπÂºè</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sigaction</span><span class="hljs-params">(<span class="hljs-type">int</span> signum, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> sigaction *act, <span class="hljs-keyword">struct</span> sigaction *oldact)</span></span>; <span class="hljs-comment">// ËÆæÁΩÆ‰ø°Âè∑Â§ÑÁêÜÊñπÂºèÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// sigaction ÁªìÊûÑ‰Ωì</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sigaction</span> {<br>    <span class="hljs-built_in">void</span> (*sa_handler)(<span class="hljs-type">int</span>); <span class="hljs-comment">// ‰ø°Âè∑Â§ÑÁêÜÂáΩÊï∞</span><br>    <span class="hljs-built_in">void</span> (*sa_sigaction)(<span class="hljs-type">int</span>, <span class="hljs-type">siginfo_t</span> *, <span class="hljs-type">void</span> *); <span class="hljs-comment">// ‰ø°Âè∑Â§ÑÁêÜÂáΩÊï∞</span><br>    <span class="hljs-type">sigset_t</span> sa_mask; <span class="hljs-comment">// ‰ø°Âè∑Â±èËîΩÂ≠ó</span><br>    <span class="hljs-type">int</span> sa_flags; <span class="hljs-comment">// ‰ø°Âè∑Â§ÑÁêÜÊ†áÂøó</span><br>};<br><br><span class="hljs-comment">// siginfo_t ÁªìÊûÑ‰Ωì</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">siginfo_t</span> {<br>    <span class="hljs-type">int</span> si_signo; <span class="hljs-comment">// ‰ø°Âè∑</span><br>    <span class="hljs-type">int</span> si_errno; <span class="hljs-comment">// ÈîôËØØÁ†Å</span><br>    <span class="hljs-type">int</span> si_code; <span class="hljs-comment">// ‰ø°Âè∑‰ª£Á†Å</span><br>    <span class="hljs-type">pid_t</span> si_pid; <span class="hljs-comment">// ÂèëÈÄÅ‰ø°Âè∑ÁöÑËøõÁ®ã ID</span><br>    <span class="hljs-type">uid_t</span> si_uid; <span class="hljs-comment">// ÂèëÈÄÅ‰ø°Âè∑ÁöÑÁî®Êà∑ ID</span><br>    <span class="hljs-type">int</span> si_status; <span class="hljs-comment">// ÈÄÄÂá∫Áä∂ÊÄÅ</span><br>    <span class="hljs-type">void</span> *si_addr; <span class="hljs-comment">// ÂÜÖÂ≠òÂú∞ÂùÄ</span><br>    <span class="hljs-type">int</span> si_band; <span class="hljs-comment">// ÈÄöÁü•‰ø°Âè∑</span><br>    <span class="hljs-type">int</span> si_fd; <span class="hljs-comment">// Êñá‰ª∂ÊèèËø∞Á¨¶</span><br>};<br></code></pre></td></tr></tbody></table></figure>
<h4 id="‰ø°Âè∑ÈõÜ">‰ø°Âè∑ÈõÜ</h4>
<h5 id="‰ø°Âè∑ÈõÜÂáΩÊï∞">‰ø°Âè∑ÈõÜÂáΩÊï∞</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/sigset.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SIGSET_NWORDS (1024 / (8 * sizeof(unsigned long int)))</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> {<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">int</span> __val[SIGSET_NWORDS];<br>} <span class="hljs-type">sigset_t</span>;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sigemptyset</span><span class="hljs-params">(<span class="hljs-type">sigset_t</span> *set)</span></span>; <span class="hljs-comment">// Ê∏ÖÁ©∫‰ø°Âè∑ÈõÜÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sigfillset</span><span class="hljs-params">(<span class="hljs-type">sigset_t</span> *set)</span></span>; <span class="hljs-comment">// Â°´ÂÖÖ‰ø°Âè∑ÈõÜÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sigaddset</span><span class="hljs-params">(<span class="hljs-type">sigset_t</span> *set, <span class="hljs-type">int</span> signum)</span></span>; <span class="hljs-comment">// Ê∑ªÂä†‰ø°Âè∑Âà∞‰ø°Âè∑ÈõÜÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sigdelset</span><span class="hljs-params">(<span class="hljs-type">sigset_t</span> *set, <span class="hljs-type">int</span> signum)</span></span>; <span class="hljs-comment">// ‰ªé‰ø°Âè∑ÈõÜ‰∏≠Âà†Èô§‰ø°Âè∑ÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sigismember</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">sigset_t</span> *set, <span class="hljs-type">int</span> signum)</span></span>; <span class="hljs-comment">// Âà§Êñ≠‰ø°Âè∑ÊòØÂê¶Âú®‰ø°Âè∑ÈõÜ‰∏≠ÔºåÊàêÂäüËøîÂõû 1ÔºåÂ§±Ë¥•ËøîÂõû 0</span><br></code></pre></td></tr></tbody></table></figure>
<h5 id="‰ø°Âè∑Êé©Á†Å">‰ø°Âè∑Êé©Á†Å</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sigprocmask</span><span class="hljs-params">(<span class="hljs-type">int</span> how, <span class="hljs-type">const</span> <span class="hljs-type">sigset_t</span> *set, <span class="hljs-type">sigset_t</span> *oldset)</span></span>; <span class="hljs-comment">// ËÆæÁΩÆ‰ø°Âè∑Êé©Á†ÅÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br><br><span class="hljs-comment">// how ÂèÇÊï∞</span><br>SIG_BLOCK <span class="hljs-comment">// Â∞Ü set ‰∏≠ÁöÑ‰ø°Âè∑Ê∑ªÂä†Âà∞ÂΩìÂâç‰ø°Âè∑Êé©Á†Å‰∏≠</span><br>SIG_UNBLOCK <span class="hljs-comment">// Â∞Ü set ‰∏≠ÁöÑ‰ø°Âè∑‰ªéÂΩìÂâç‰ø°Âè∑Êé©Á†Å‰∏≠Âà†Èô§</span><br>SIG_SETMASK <span class="hljs-comment">// Â∞ÜÂΩìÂâç‰ø°Âè∑Êé©Á†ÅËÆæÁΩÆ‰∏∫ set</span><br></code></pre></td></tr></tbody></table></figure>
<h5 id="Ë¢´ÊåÇËµ∑ÁöÑ‰ø°Âè∑">Ë¢´ÊåÇËµ∑ÁöÑ‰ø°Âè∑</h5>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-comment">// Ë¢´Êé©Á†ÅÂ±èËîΩÁöÑ‰ø°Âè∑</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sigpending</span><span class="hljs-params">(<span class="hljs-type">sigset_t</span> *set)</span></span>; <span class="hljs-comment">// Ëé∑ÂèñË¢´ÊåÇËµ∑ÁöÑ‰ø°Âè∑ÔºåÊàêÂäüËøîÂõû 0ÔºåÂ§±Ë¥•ËøîÂõû -1</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="Áªü‰∏Ä‰∫ã‰ª∂Ê∫ê">Áªü‰∏Ä‰∫ã‰ª∂Ê∫ê</h4>
<p>Áªü‰∏Ä‰∫ã‰ª∂Ê∫êÊòØÊåáÁõ¥Êé•Âú®‰∏ªÂæ™ÁéØ‰∏≠Áªü‰∏ÄÂ§ÑÁêÜ‰ø°Âè∑Âíå I/O ‰∫ã‰ª∂Ôºå‰∏ªË¶ÅÊúâ‰∏§ÁßçÊñπÂºèÔºö - ‰ø°Âè∑Â§ÑÁêÜÂáΩÊï∞‰∏≠‰ΩøÁî®ÁÆ°ÈÅìÈÄöÁü•‰∏ªÂæ™ÁéØ - ‰ø°Âè∑Â§ÑÁêÜÂáΩÊï∞‰∏≠‰ΩøÁî®‰ø°Âè∑ÈáèÈÄöÁü•‰∏ªÂæ™ÁéØ</p>
<h2 id="ÂÆöÊó∂Âô®">ÂÆöÊó∂Âô®</h2>
<h4 id="socket-ÈÄâÈ°π-so_rcvtimeo-Âíå-so_sndtimeo">socket ÈÄâÈ°π SO_RCVTIMEO Âíå SO_SNDTIMEO</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">timeout_connect</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *ip, <span class="hljs-type">int</span> port, <span class="hljs-type">int</span> time)</span> </span>{<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> address;<br>    <span class="hljs-built_in">bzero</span>(&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br>    address.sin_family = AF_INET;<br>    <span class="hljs-built_in">inet_pton</span>(AF_INET, ip, &amp;address.sin_addr);<br>    address.sin_port = <span class="hljs-built_in">htons</span>(port);<br><br>    <span class="hljs-type">int</span> sockfd = <span class="hljs-built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">timeval</span> timeout;<br>    timeout.tv_sec = time;<br>    timeout.tv_usec = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">socklen_t</span> len = <span class="hljs-built_in">sizeof</span>(timeout);<br>    <span class="hljs-type">int</span> ret = <span class="hljs-built_in">setsockopt</span>(sockfd, SOL_SOCKET, SO_SNDTIMEO,, &amp;timeout, len);<br>    <br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br><br>    ret = <span class="hljs-built_in">connect</span>(sockfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br><br>    <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">-1</span>) {<br>        <span class="hljs-keyword">if</span> (errno == EINPROGRESS) {<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"connecting timeout, process timeout logic\n"</span>);<br>            <span class="hljs-comment">// Â§ÑÁêÜË∂ÖÊó∂ÈÄªËæë</span><br>            <span class="hljs-comment">// ...</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>        }<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"error occur when connecting to server\n"</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    } <br><br>    <span class="hljs-keyword">return</span> sockfd;<br>}<br></code></pre></td></tr></tbody></table></figure>
<h4 id="Êó∂Èó¥ËΩÆÂÆöÊó∂Âô®">Êó∂Èó¥ËΩÆÂÆöÊó∂Âô®</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BUFFER_SIZE 64</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> FD_LIMIT 65535</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_EVENT_NUMBER 1024</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TIMESLOT 5</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> pipefd[<span class="hljs-number">2</span>];<br><span class="hljs-type">static</span> sort timer_lst;<br><span class="hljs-type">static</span> <span class="hljs-type">int</span> epollfd = <span class="hljs-number">0</span>;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">setnonblocking</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span> </span>{<br>    <span class="hljs-type">int</span> old_option = <span class="hljs-built_in">fcntl</span>(fd, F_GETFL);<br>    <span class="hljs-type">int</span> new_option = old_option | O_NONBLOCK;<br>    <span class="hljs-built_in">fcntl</span>(fd, F_SETFL, new_option);<br>    <span class="hljs-keyword">return</span> old_option;<br>}<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addfd</span><span class="hljs-params">(<span class="hljs-type">int</span> epollfd, <span class="hljs-type">int</span> fd)</span> </span>{<br>    epoll_event event;<br>    event.data.fd = fd;<br>    event.events = EPOLLIN | EPOLLET;<br>    <span class="hljs-built_in">epoll_ctl</span>(epollfd, EPOLL_CTL_ADD, fd, &amp;event);<br>    <span class="hljs-built_in">setnonblocking</span>(fd);<br>}<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sig_handler</span><span class="hljs-params">(<span class="hljs-type">int</span> sig)</span> </span>{<br>    <span class="hljs-type">int</span> save_errno = errno;<br>    <span class="hljs-type">int</span> msg = sig;<br>    <span class="hljs-built_in">send</span>(pipefd[<span class="hljs-number">1</span>], (<span class="hljs-type">char</span> *)&amp;msg, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>    errno = save_errno;<br>}<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addsig</span><span class="hljs-params">(<span class="hljs-type">int</span> sig)</span> </span>{<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sigaction</span> sa;<br>    <span class="hljs-built_in">memset</span>(&amp;sa, <span class="hljs-string">'\0'</span>, <span class="hljs-built_in">sizeof</span>(sa));<br>    sa.sa_handler = sig_handler;<br>    sa.sa_flags |= SA_RESTART;<br>    <span class="hljs-built_in">sigfillset</span>(&amp;sa.sa_mask);<br>    <span class="hljs-built_in">assert</span>(<span class="hljs-built_in">sigaction</span>(sig, &amp;sa, <span class="hljs-literal">NULL</span>) != <span class="hljs-number">-1</span>);<br>}<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">timer_handler</span><span class="hljs-params">()</span> </span>{<br>    timer_lst.<span class="hljs-built_in">tick</span>();<br>    <span class="hljs-built_in">alarm</span>(TIMESLOT);<br>}<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">cb_func</span><span class="hljs-params">(client_data *user_data)</span> </span>{<br>    <span class="hljs-built_in">epoll_ctl</span>(epollfd, EPOLL_CTL_DEL, user_data-&gt;sockfd, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">assert</span>(user_data);<br>    <span class="hljs-built_in">close</span>(user_data-&gt;sockfd);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"close fd %d\n"</span>, user_data-&gt;sockfd);<br>}<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>{<br>    <span class="hljs-type">int</span> port = <span class="hljs-built_in">atoi</span>(argv[<span class="hljs-number">1</span>]);<br><br>    <span class="hljs-type">int</span> listenfd = <span class="hljs-built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">assert</span>(listenfd &gt;= <span class="hljs-number">0</span>);<br><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> address;<br>    <span class="hljs-built_in">bzero</span>(&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br>    address.sin_family = AF_INET;<br>    address.sin_addr.s_addr = <span class="hljs-built_in">htonl</span>(INADDR_ANY);<br>    address.sin_port = <span class="hljs-built_in">htons</span>(port);<br><br>    <span class="hljs-type">int</span> ret = <span class="hljs-built_in">bind</span>(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br><br>    ret = <span class="hljs-built_in">listen</span>(listenfd, <span class="hljs-number">5</span>);<br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br><br>    epoll_event events[MAX_EVENT_NUMBER];<br>    epollfd = <span class="hljs-built_in">epoll_create</span>(<span class="hljs-number">5</span>);<br>    <span class="hljs-built_in">assert</span>(epollfd != <span class="hljs-number">-1</span>);<br>    <span class="hljs-built_in">addfd</span>(epollfd, listenfd);<br><br>    ret = <span class="hljs-built_in">socketpair</span>(PF_UNIX, SOCK_STREAM, <span class="hljs-number">0</span>, pipefd);<br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br>    <span class="hljs-built_in">setnonblocking</span>(pipefd[<span class="hljs-number">1</span>]);<br>    <span class="hljs-built_in">addfd</span>(epollfd, pipefd[<span class="hljs-number">0</span>]);<br><br>    <span class="hljs-built_in">addsig</span>(SIGALRM);<br>    <span class="hljs-built_in">addsig</span>(SIGTERM);<br><br>    client_data *users = <span class="hljs-keyword">new</span> client_data[FD_LIMIT];<br>    <span class="hljs-type">bool</span> stop_server = <span class="hljs-literal">false</span>;<br>    <span class="hljs-type">bool</span> timeout = <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-built_in">alarm</span>(TIMESLOT);<br><br>    <span class="hljs-keyword">while</span> (!stop_server) {<br>        <span class="hljs-type">int</span> number = <span class="hljs-built_in">epoll_wait</span>(epollfd, events, MAX_EVENT_NUMBER, <span class="hljs-number">-1</span>);<br>        <span class="hljs-keyword">if</span> ((number &lt; <span class="hljs-number">0</span>) &amp;&amp; (errno != EINTR)) {<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"epoll failure\n"</span>);<br>            <span class="hljs-keyword">break</span>;<br>        }<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; number; i++) {<br>            <span class="hljs-type">int</span> sockfd = events[i].data.fd;<br>            <span class="hljs-keyword">if</span> (sockfd == listenfd) {<br>                <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> client_address;<br>                <span class="hljs-type">socklen_t</span> client_addrlength = <span class="hljs-built_in">sizeof</span>(client_address);<br>                <span class="hljs-type">int</span> connfd = <span class="hljs-built_in">accept</span>(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;client_address, &amp;client_addrlength);<br>                <span class="hljs-built_in">addfd</span>(epollfd, connfd);<br>                users[connfd].address = client_address;<br>                users[connfd].sockfd = connfd;<br><br>                heap_timer *timer = <span class="hljs-keyword">new</span> <span class="hljs-built_in">heap_timer</span>(<span class="hljs-number">3</span> * TIMESLOT);<br>                timer-&gt;user_data = &amp;users[connfd];<br>                timer-&gt;cb_func = cb_func;<br>                users[connfd].timer = timer;<br>                timer_lst.<span class="hljs-built_in">add_timer</span>(timer);<br>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((sockfd == pipefd[<span class="hljs-number">0</span>]) &amp;&amp; (events[i].events &amp; EPOLLIN)) {<br>                <span class="hljs-type">int</span> sig;<br>                <span class="hljs-type">char</span> signals[<span class="hljs-number">1024</span>];<br>                ret = <span class="hljs-built_in">recv</span>(pipefd[<span class="hljs-number">0</span>], signals, <span class="hljs-built_in">sizeof</span>(signals), <span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">-1</span>) {<br>                    <span class="hljs-keyword">continue</span>;<br>                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>) {<br>                    <span class="hljs-keyword">continue</span>;<br>                } <span class="hljs-keyword">else</span> {<br>                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; ret; i++) {<br>                        <span class="hljs-keyword">switch</span> (signals[i]) {<br>                            <span class="hljs-keyword">case</span> SIGALRM:<br>                                timeout = <span class="hljs-literal">true</span>;<br>                                <span class="hljs-keyword">break</span>;<br>                            <span class="hljs-keyword">case</span> SIGTERM:<br>                                stop_server = <span class="hljs-literal">true</span>;<br>                        }<br>                    }<br>                }<br>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (events[i].events &amp; EPOLLIN) {<br>                <span class="hljs-built_in">memset</span>(users[sockfd].buf, <span class="hljs-string">'\0'</span>, BUFFER_SIZE);<br>                ret = <span class="hljs-built_in">recv</span>(sockfd, users[sockfd].buf, BUFFER_SIZE - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get %d bytes of client data %s from %d\n"</span>, ret, users[sockfd].buf, sockfd);<br><br>                heap_timer *timer = users[sockfd].timer;<br>                <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) {<br>                    <span class="hljs-keyword">if</span> (errno != EAGAIN) {<br>                        <span class="hljs-built_in">cb_func</span>(&amp;users[sockfd]);<br>                        <span class="hljs-keyword">if</span> (timer) {<br>                            timer_lst.<span class="hljs-built_in">del_timer</span>(timer);<br>                        }<br>                    }<br>                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>) {<br>                    <span class="hljs-built_in">cb_func</span>(&amp;users[sockfd]);<br>                    <span class="hljs-keyword">if</span> (timer) {<br>                        timer_lst.<span class="hljs-built_in">del_timer</span>(timer);<br>                    }<br>                } <span class="hljs-keyword">else</span> {<br>                    <span class="hljs-keyword">if</span> (timer) {<br>                        <span class="hljs-type">time_t</span> cur = <span class="hljs-built_in">time</span>(<span class="hljs-literal">NULL</span>);<br>                        timer-&gt;expire = cur + <span class="hljs-number">3</span> * TIMESLOT;<br>                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"adjust timer once\n"</span>);<br>                        timer_lst.<span class="hljs-built_in">adjust_timer</span>(timer);<br>                    }<br>                }<br>            } <span class="hljs-keyword">else</span> {<br>                <span class="hljs-comment">// other things</span><br>            }<br><br>            <span class="hljs-keyword">if</span> (timeout) {<br>                <span class="hljs-built_in">timer_handler</span>();<br>                timeout = <span class="hljs-literal">false</span>;<br>            }<br>        }<br>    }<br><br>    <span class="hljs-built_in">close</span>(listenfd);<br>    <span class="hljs-built_in">close</span>(pipefd[<span class="hljs-number">1</span>]);<br>    <span class="hljs-built_in">close</span>(pipefd[<span class="hljs-number">0</span>]);<br>    <span class="hljs-keyword">delete</span> [] users;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>
<h4 id="Êó∂Èó¥Â†Ü">Êó∂Èó¥Â†Ü</h4>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assert.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BUFFER_SIZE 64</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> FD_LIMIT 65535</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_EVENT_NUMBER 1024</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TIMESLOT 5</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">heap_timer</span>;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">client_data</span> {<br>    sockaddr_in address;<br>    <span class="hljs-type">int</span> sockfd;<br>    <span class="hljs-type">char</span> buf[BUFFER_SIZE];<br>    heap_timer *timer;<br>};<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">heap_timer</span> {<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">heap_timer</span>(<span class="hljs-type">int</span> delay) {<br>        expire = <span class="hljs-built_in">time</span>(<span class="hljs-literal">NULL</span>) + delay;<br>    }<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-type">time_t</span> expire;<br>    <span class="hljs-built_in">void</span> (*cb_func)(client_data *);<br>    client_data *user_data;<br>};<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">time_heap</span> {<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">time_heap</span>(<span class="hljs-type">int</span> cap) : <span class="hljs-built_in">capacity</span>(cap), <span class="hljs-built_in">cur_size</span>(<span class="hljs-number">0</span>) {<br>        array = <span class="hljs-keyword">new</span> heap_timer*[capacity];<br>        <span class="hljs-keyword">if</span> (!array) {<br>            <span class="hljs-built_in">perror</span>(<span class="hljs-string">"new error"</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        }<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; capacity; i++) {<br>            array[i] = <span class="hljs-literal">NULL</span>;<br>        }<br>    }<br><br>    <span class="hljs-built_in">time_heap</span>(heap_timer **init_array, <span class="hljs-type">int</span> size, <span class="hljs-type">int</span> capacity) : <span class="hljs-built_in">cur_size</span>(size), <span class="hljs-built_in">capacity</span>(capacity) {<br>        <span class="hljs-keyword">if</span> (capacity &lt; size) {<br>            <span class="hljs-built_in">perror</span>(<span class="hljs-string">"capacity error"</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        }<br>        array = <span class="hljs-keyword">new</span> heap_timer*[capacity];<br>        <span class="hljs-keyword">if</span> (!array) {<br>            <span class="hljs-built_in">perror</span>(<span class="hljs-string">"new error"</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        }<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; capacity; i++) {<br>            array[i] = <span class="hljs-literal">NULL</span>;<br>        }<br>        <span class="hljs-keyword">if</span> (size != <span class="hljs-number">0</span>) {<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; size; i++) {<br>                array[i] = init_array[i];<br>            }<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = (cur_size - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>; i &gt;= <span class="hljs-number">0</span>; i--) {<br>                <span class="hljs-built_in">percolate_down</span>(i);<br>            }<br>        }<br>    }<br><br>    ~<span class="hljs-built_in">time_heap</span>() {<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; cur_size; i++) {<br>            <span class="hljs-keyword">delete</span> array[i];<br>        }<br>        <span class="hljs-keyword">delete</span> [] array;<br>    }<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_timer</span><span class="hljs-params">(heap_timer *timer)</span> </span>{<br>        <span class="hljs-keyword">if</span> (!timer) {<br>            <span class="hljs-keyword">return</span>;<br>        }<br>        <span class="hljs-keyword">if</span> (cur_size &gt;= capacity) {<br>            <span class="hljs-built_in">resize</span>();<br>        }<br>        <span class="hljs-type">int</span> hole = cur_size++;<br>        <span class="hljs-type">int</span> parent = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (; hole &gt; <span class="hljs-number">0</span>; hole = parent) {<br>            parent = (hole - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;<br>            <span class="hljs-keyword">if</span> (array[parent]-&gt;expire &lt;= timer-&gt;expire) {<br>                <span class="hljs-keyword">break</span>;<br>            }<br>            array[hole] = array[parent];<br>        }<br>        array[hole] = timer;<br>    }<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">del_timer</span><span class="hljs-params">(heap_timer *timer)</span> </span>{<br>        <span class="hljs-keyword">if</span> (!timer) {<br>            <span class="hljs-keyword">return</span>;<br>        }<br>        timer-&gt;cb_func = <span class="hljs-literal">NULL</span>;<br>    }<br><br>    <span class="hljs-function">heap_timer *<span class="hljs-title">top</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">empty</span>()) {<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>        }<br>        <span class="hljs-keyword">return</span> array[<span class="hljs-number">0</span>];<br>    }<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pop_timer</span><span class="hljs-params">()</span> </span>{<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">empty</span>()) {<br>            <span class="hljs-keyword">return</span>;<br>        }<br>        <span class="hljs-keyword">if</span> (array[<span class="hljs-number">0</span>]) {<br>            <span class="hljs-keyword">delete</span> array[<span class="hljs-number">0</span>];<br>            array[<span class="hljs-number">0</span>] = array[--cur_size];<br>            <span class="hljs-built_in">percolate_down</span>(<span class="hljs-number">0</span>);<br>        }<br>    }<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">tick</span><span class="hljs-params">()</span> </span>{<br>        heap_timer *tmp = array[<span class="hljs-number">0</span>];<br>        <span class="hljs-type">time_t</span> cur = <span class="hljs-built_in">time</span>(<span class="hljs-literal">NULL</span>);<br>        <span class="hljs-keyword">while</span> (!<span class="hljs-built_in">empty</span>()) {<br>            <span class="hljs-keyword">if</span> (!tmp) {<br>                <span class="hljs-keyword">break</span>;<br>            }<br>            <span class="hljs-keyword">if</span> (tmp-&gt;expire &gt; cur) {<br>                <span class="hljs-keyword">break</span>;<br>            }<br>            <span class="hljs-keyword">if</span> (array[<span class="hljs-number">0</span>]-&gt;cb_func) {<br>                array[<span class="hljs-number">0</span>]-&gt;<span class="hljs-built_in">cb_func</span>(array[<span class="hljs-number">0</span>]-&gt;user_data);<br>            }<br>            <span class="hljs-built_in">pop_timer</span>();<br>            tmp = array[<span class="hljs-number">0</span>];<br>        }<br>    }<br><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{<br>        <span class="hljs-keyword">return</span> cur_size == <span class="hljs-number">0</span>;<br>    }<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">percolate_down</span><span class="hljs-params">(<span class="hljs-type">int</span> hole)</span> </span>{<br>        heap_timer *temp = array[hole];<br>        <span class="hljs-type">int</span> child = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (; ((hole * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>) &lt;= (cur_size - <span class="hljs-number">1</span>)); hole = child) {<br>            child = hole * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">if</span> ((child &lt; (cur_size - <span class="hljs-number">1</span>)) &amp;&amp; (array[child + <span class="hljs-number">1</span>]-&gt;expire &lt; array[child]-&gt;expire)) {<br>                ++child;<br>            }<br>            <span class="hljs-keyword">if</span> (array[child]-&gt;expire &lt; temp-&gt;expire) {<br>                array[hole] = array[child];<br>            } <span class="hljs-keyword">else</span> {<br>                <span class="hljs-keyword">break</span>;<br>            }<br>        }<br>        array[hole] = temp;<br>    }<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">resize</span><span class="hljs-params">()</span> </span>{<br>        heap_timer **temp = <span class="hljs-keyword">new</span> heap_timer*[<span class="hljs-number">2</span> * capacity];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span> * capacity; i++) {<br>            temp[i] = <span class="hljs-literal">NULL</span>;<br>        }<br>        <span class="hljs-keyword">if</span> (!temp) {<br>            <span class="hljs-built_in">perror</span>(<span class="hljs-string">"new error"</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        }<br>        capacity = <span class="hljs-number">2</span> * capacity;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; cur_size; i++) {<br>            temp[i] = array[i];<br>        }<br>        <span class="hljs-keyword">delete</span> [] array;<br>        array = temp;<br>    }<br><br><span class="hljs-keyword">private</span>:<br>    heap_timer **array;<br>    <span class="hljs-type">int</span> capacity;<br>    <span class="hljs-type">int</span> cur_size;<br>};<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">cb_func</span><span class="hljs-params">(client_data *user_data)</span> </span>{<br>    <span class="hljs-built_in">epoll_ctl</span>(epollfd, EPOLL_CTL_DEL, user_data-&gt;sockfd, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">assert</span>(user_data);<br>    <span class="hljs-built_in">close</span>(user_data-&gt;sockfd);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"close fd %d\n"</span>, user_data-&gt;sockfd);<br>}<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>{<br>    <span class="hljs-type">int</span> port = <span class="hljs-built_in">atoi</span>(argv[<span class="hljs-number">1</span>]);<br><br>    <span class="hljs-type">int</span> listenfd = <span class="hljs-built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">assert</span>(listenfd &gt;= <span class="hljs-number">0</span>);<br><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> address;<br>    <span class="hljs-built_in">bzero</span>(&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br>    address.sin_family = AF_INET;<br>    address.sin_addr.s_addr = <span class="hljs-built_in">htonl</span>(INADDR_ANY);<br>    address.sin_port = <span class="hljs-built_in">htons</span>(port);<br><br>    <span class="hljs-type">int</span> ret = <span class="hljs-built_in">bind</span>(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;address, <span class="hljs-built_in">sizeof</span>(address));<br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br><br>    ret = <span class="hljs-built_in">listen</span>(listenfd, <span class="hljs-number">5</span>);<br>    <span class="hljs-built_in">assert</span>(ret != <span class="hljs-number">-1</span>);<br><br>    <span class="hljs-function">time_heap <span class="hljs-title">timer_lst</span><span class="hljs-params">(<span class="hljs-number">60</span>)</span></span>;<br>    epoll_event events[MAX_EVENT_NUMBER];<br>    <span class="hljs-type">int</span> epollfd = <span class="hljs-built_in">epoll_create</span>(<span class="hljs-number">5</span>);<br>    <span class="hljs-built_in">assert</span>(epollfd != <span class="hljs-number">-1</span>);<br>    <span class="hljs-built_in">addfd</span>(epollfd, listenfd);<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {<br>        <span class="hljs-type">int</span> number = <span class="hljs-built_in">epoll_wait</span>(epollfd, events, MAX_EVENT_NUMBER, <span class="hljs-number">-1</span>);<br>        <span class="hljs-keyword">if</span> ((number &lt; <span class="hljs-number">0</span>) &amp;&amp; (errno != EINTR)) {<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"epoll failure\n"</span>);<br>            <span class="hljs-keyword">break</span>;<br>        }<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; number; i++) {<br>            <span class="hljs-type">int</span> sockfd = events[i].data.fd;<br>            <span class="hljs-keyword">if</span> (sockfd == listenfd) {<br>                <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> client_address;<br>                <span class="hljs-type">socklen_t</span> client_addrlength = <span class="hljs-built_in">sizeof</span>(client_address);<br>                <span class="hljs-type">int</span> connfd = <span class="hljs-built_in">accept</span>(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;client_address, &amp;client_addrlength);<br>                <span class="hljs-built_in">addfd</span>(epollfd, connfd);<br>                client_data *user_data = <span class="hljs-keyword">new</span> client_data;<br>                user_data-&gt;address = client_address;<br>                user_data-&gt;sockfd = connfd;<br><br>                heap_timer *timer = <span class="hljs-keyword">new</span> <span class="hljs-built_in">heap_timer</span>(<span class="hljs-number">3</span> * TIMESLOT);<br>                timer-&gt;user_data = user_data;<br>                timer-&gt;cb_func = cb_func;<br>                user_data-&gt;timer = timer;<br>                timer_lst.<span class="hljs-built_in">add_timer</span>(timer);<br>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (events[i].events &amp; EPOLLIN) {<br>                <span class="hljs-built_in">memset</span>(users[sockfd].buf, <span class="hljs-string">'\0'</span>, BUFFER_SIZE);<br>                ret = <span class="hljs-built_in">recv</span>(sockfd, users[sockfd].buf, BUFFER_SIZE - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get %d bytes of client data %s from %d\n"</span>, ret, users[sockfd].buf, sockfd);<br><br>                heap_timer *timer = users[sockfd].timer;<br>                <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) {<br>                    <span class="hljs-keyword">if</span> (errno != EAGAIN) {<br>                        <span class="hljs-built_in">cb_func</span>(&amp;users[sockfd]);<br>                        <span class="hljs-keyword">if</span> (timer) {<br>                            timer_lst.<span class="hljs-built_in">del_timer</span>(timer);<br>                        }<br>                    }<br>                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>) {<br>                    <span class="hljs-built_in">cb_func</span>(&amp;users[sockfd]);<br>                    <span class="hljs-keyword">if</span> (timer) {<br>                        timer_lst.<span class="hljs-built_in">del_timer</span>(timer);<br>                    }<br>                } <span class="hljs-keyword">else</span> {<br>                    <span class="hljs-keyword">if</span> (timer) {<br>                        <span class="hljs-type">time_t</span> cur = <span class="hljs-built_in">time</span>(<span class="hljs-literal">NULL</span>);<br>                        timer-&gt;expire = cur + <span class="hljs-number">3</span> * TIMESLOT;<br>                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"adjust timer once\n"</span>);<br>                        timer_lst.<span class="hljs-built_in">adjust_timer</span>(timer);<br>                    }<br>                }<br>            } <span class="hljs-keyword">else</span> {<br>                <span class="hljs-comment">// other things</span><br>            }<br>        }<br><br>        timer_lst.<span class="hljs-built_in">tick</span>();<br>    }<br><br>    <span class="hljs-built_in">close</span>(listenfd);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="È´òÊÄßËÉΩ-io-Ê°ÜÊû∂Â∫ì-libevent">È´òÊÄßËÉΩ I/O Ê°ÜÊû∂Â∫ì Libevent</h2>
<p><a target="_blank" rel="noopener" href="https://libevent.org/">libevent.org</a></p>
<h4 id="‰∫ã‰ª∂Â§öË∑ØÂàÜÂèëÂô®-event-demultiplexer">‰∫ã‰ª∂Â§öË∑ØÂàÜÂèëÂô® Event Demultiplexer</h4>
<div class="figure">
<img src="EventDemult.png" srcset="/img/loading.gif" lazyload alt="EventDemult">
<p class="caption">EventDemult</p>
</div>
<div class="figure">
<img src="Libeventgraph.png" srcset="/img/loading.gif" lazyload alt="Libeventgraph">
<p class="caption">Libeventgraph</p>
</div>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Linux/" class="category-chain-item">Linux</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Linux/" class="print-no-link">#Linux</a>
      
        <a href="/tags/C/" class="print-no-link">#C++</a>
      
        <a href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="print-no-link">#ÁΩëÁªúÁºñÁ®ã</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Linux È´òÊÄßËÉΩÊúçÂä°Âô®ÁºñÁ®ã</div>
      <div>https://github.com/Cookiecoolkid/Cookiecoolkid.github.io/2024/10/20/Linux-È´òÊÄßËÉΩÊúçÂä°Âô®ÁºñÁ®ã/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>‰ΩúËÄÖ</div>
          <div>Cookiecoolkid</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>ÂèëÂ∏É‰∫é</div>
          <div>2024Âπ¥10Êúà20Êó•</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>ËÆ∏ÂèØÂçèËÆÆ</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ÁΩ≤Âêç">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/10/30/http-format/" title="http/1.x format">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">http/1.x format</span>
                        <span class="visible-mobile">‰∏ä‰∏ÄÁØá</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ÁõÆÂΩï</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">ÊêúÁ¥¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">ÂÖ≥ÈîÆËØç</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- ‰∏ªÈ¢òÁöÑÂêØÂä®È°πÔºåÂ∞ÜÂÆÉ‰øùÊåÅÂú®ÊúÄÂ∫ïÈÉ® -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">ÂçöÂÆ¢Âú®ÂÖÅËÆ∏ JavaScript ËøêË°åÁöÑÁéØÂ¢É‰∏ãÊµèËßàÊïàÊûúÊõ¥‰Ω≥</div>
  </noscript>
</body>
</html>
